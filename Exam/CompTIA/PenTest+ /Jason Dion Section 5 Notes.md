# Scanning and Enumeration (OBJ 2.2 and 2.3)

## Overview

After conducting initial footprinting and passive reconnaissance, the next step in penetration testing involves active reconnaissance. This process includes scanning and enumerating the target organization's systems to identify hosts, open ports, services, users, domain names, and URLs.

## Types of Scans

### Discovery Scan
- **Purpose:** Identify hosts that are online and determine open ports and services.
- **Methods:** 
  - **Ping Scan:** Identifies online hosts within a network.
  - **Port Scan:** Determines which ports and services are open on a host.

### Enumeration
- **Purpose:** Gather detailed information about identified hosts and their open ports.
- **Methods:** 
  - **Tools:** Nmap (command line) and Zenmap (GUI).
  - **Process:** 
    - Conduct a ping scan to find online hosts.
    - Perform a quick scan to identify open ports.
    - Execute an intensive scan to determine running services and their versions.

## Scanning Tools

### Nmap
- **Description:** A command line tool for various types of scans.
- **Capabilities:** 
  - Syntax-based setup for different scans.
  - Conducts ping scans, quick scans, and intense scans.

### Zenmap
- **Description:** A graphical interface for Nmap.
- **Capabilities:** 
  - Dropdown menus for selecting scan types.
  - Easy configuration of scans via domain names or IP ranges.

## Detailed Enumeration and Fingerprinting

### Intensive Scanning
- **Process:** 
  - Identify services running on open ports.
  - Determine exact software versions.
  - Example: Discover vsftpd version 2.3.4 running on port 21.

### Operating System Identification
- **Method:** Analyze system responses to queries.
- **Tools:** Zenmap, Nmap.
- **Example:** Identify a target system as Windows XP with specific service packs.

### Manual Banner Grabbing
- **Tools:** Netcat, wget, telnet.
- **Process:** 
  - Connect to a port and observe the service's response.
  - Example: Use Netcat to identify Apache web server version 2.2.16 on Debian Linux.

- `GET/HTTP/1.1`
- `wget <domain name or IP address> -S` 

### Packet Crafting
- **Tools:** Nmap, Zenmap, hping, Netcat, Ncat.
- **Process:** 
  - Modify packet headers to elicit specific responses.
  - Example: Use hping to send crafted SYN packets and analyze responses in Wireshark.

- `Nmap -sV <target domain or IP> -p <port number>`
- `hping3 --syn -p 80 192.168.1.15`

### Packet Analysis
- **Tool:** Wireshark.
- **Process:** 
  - Capture and analyze network packets.
  - Example: Identify a Microsoft ESMTP server and its software version.

## Summary

- **Scanning:** A generic process to identify online hosts and open ports.
- **Enumeration:** A more detailed process to gather information about services and software versions.
- **Fingerprinting:** The most detailed process to capture specific information about hosts or services.

By using tools like Nmap, Zenmap, Netcat, and Wireshark, penetration testers can conduct thorough scanning, enumeration, and fingerprinting to identify vulnerabilities and plan their exploitation strategies effectively.

#

# Conducting Enumeration (OBJ 2.3)

# Using Zenmap for Scanning and Enumeration

In this video, I'm going to demonstrate how to use Zenmap to conduct scanning and enumeration. For this example, I am connected directly to the local area network of my victim machines.

## Initial Scan: Ping Scan
1. **Ping Scan Setup**: 
   - Target network: `192.168.56.0/24`
   - Zenmap shows the Nmap command syntax.
   - Profile selected: Ping scan (`-sn`).
2. **Ping Scan Execution**:
   - Click on **Scan**.
   - Results: 4 hosts up (server, DHCP server, 2 virtual machines, and Kali Linux box).

## Further Scans
1. **Quick Scan**:
   - Target machines: `192.168.56.100` and `192.168.56.101`.
   - Quick scan checks common ports.
   - Results for `101`: Several open ports indicating potential vulnerabilities.
   - Results for `100`: All ports filtered.
   - Identified services: FTP, SSH, Telnet, RPC bind, Samba.

2. **Intense Scan**:
   - Profile selected: Intense scan.
   - Targets: `192.168.56.100` and `192.168.56.101`.
   - Scans for open and closed ports and attempts basic enumeration.
   - Results for `101`: Detailed service versions (e.g., VSftpd, Apache, Samba).

## Analysis of Results
1. **Machine Identification**:
   - `101`: Likely a Linux machine with Microsoft services.
   - `100`: Windows machine with firewall blocking many ports.
   
2. **Firewall Configuration Check**:
   - Windows firewall settings checked.
   - Exception for file and print sharing enabled.

3. **Rescan of Windows Machine**:
   - Quick scan after firewall exception.
   - Identified open ports: `139` and `445`.

4. **Detailed Enumeration**:
   - Intense scan on `100`.
   - Identified OS: Windows XP or 2000.
   - Additional information: NetBIOS details, SMB, trace route.

## Conclusion
- **Scanning Strategy**:
  - **Quiet Scans**: Minimal detection, realistic threat emulation.
  - **Loud Scans**: High detection, easier defender training.
  - Choice depends on assessment goals and method during the hack.

- **Tool Utilization**:
  - Understanding and customizing tools like Zenmap/Nmap for specific needs is crucial for effective scanning and enumeration.

#

# Other Enumeration (OBJ 2.2 and 2.3)

# Enumeration in Cybersecurity

When conducting enumeration, you're gathering detailed information on various targets within an organization. Enumeration typically focuses on five key areas: hosts, services, domains, users, and URLs. During the attacks and exploits phase, you'll return to enumeration to expand your search from inside the network once you've gained an initial foothold. Here's a quick look at the type of information you can gather during active reconnaissance efforts:

## 1. Hosts
A host can be any server, workstation, client, mobile device, tablet, IoT device, or networking device like switches, routers, or access points. Basic host enumeration can be done using tools like Zenmap and Nmap for ping scans and port scans. 

If you have network access (e.g., emulating an insider threat), you can use Windows command line tools such as:
- `net view`: Lists network shares from the workstation.
- `arp -a`: Displays the ARP cache with MAC addresses of machines recently communicated with.
- `ipconfig /displaydns`: Shows recently resolved DNS names.

For Linux hosts, use:
- `finger`: Views a user's directory, login name, and idle time.
- `uname -a`: Displays OS name and version.
- `env`: Lists all environmental variables.

## 2. Services
Enumerating services provides details about a given host. Nmap can conduct intensive scans to identify services running on open ports. For instance, discovering port 80 open indicates a web server, but further enumeration is needed to identify the software (e.g., Apache, IIS, NGINX) and its version. 

## 3. Domains
When referring to domain enumeration, it pertains to a Windows domain, not a website domain or DNS entry. Active Directory (AD) is used to connect hosts to servers and resources using Kerberos authentication. Enumeration involves understanding the domain structure, including Organizational Units (OUs), domain trust relationships, and user/group permissions. Tools like PowerShell can be used:
- `Get-NetDomain`: Lists the current logged-in user's domain.
- `Get-NetLoggedon`: Lists all users logged into a given computer.

## 4. Users
Enumerating users includes identifying groups they belong to, as this defines their access rights and permissions. If you have a user's credentials:
- `Get-NetGroupMember`: Lists domain members of a given group.
- `net user`: Lists all users on a given machine.
- `net groups`: Lists all groups on a machine.

## 5. URLs
Enumerating URLs helps gain more details about web servers or applications running on those URLs. Nmap's scripting engine can be used:
- `nmap --script=http-enum <target URL>`: Returns information about the services and applications running on the web server, like CMS systems (Drupal, Joomla, WordPress).

This gathered information aids in planning future attacks and exploits during the engagement's third stage.

#

# Website Reconnaissance (OBJ 2.3)

## Website Reconnaissance and Enumeration

### Importance of Website Reconnaissance
Organizations invest heavily in their websites to reach new customers and sell products. Consequently, penetration tests often involve website reconnaissance and attacks. 

### Key Areas of Focus
1. **Software and Server Information**:
    - Determine the type of software running the website (e.g., CMS like WordPress, Drupal, Joomla).
    - Identify the operating system and whether the server is hosted by the organization or a third-party cloud provider.
    - Discover server resources and hidden information exposed on the website.

2. **Website Code and Content Management Systems (CMS)**:
    - Websites are either custom-built using HTML, CSS, JavaScript, etc., or built on CMS platforms.
    - WordPress is the most popular CMS, running 62% of CMS-based websites and 37% of all websites.
    - Identifying the CMS helps in finding specific vulnerabilities for exploitation.

3. **Common Vulnerabilities in Custom-Built Websites**:
    - SQL injections, XML injections, cross-site scripting, and caching server attacks.
    - Identify functions for e-commerce, content searching, and user input for potential exploits.

4. **Website Crawling and Forced Browsing**:
    - Use crawling to find all pages, including hidden ones not linked directly.
    - **robots.txt** file: Check this file for directories the site owners don't want crawlers to index.
    - Tools like DirBuster perform brute force web crawling to discover hidden data.

5. **Web Scraping**:
    - Extract data using automation or manual processes (e.g., tools like CeWL for generating word lists for password cracking).
    - Useful for gathering information on email addresses and potential password words related to the business or individuals.

6. **Enumeration Techniques**:
    - Check for valid user accounts by entering usernames and observing error messages.
    - Look for specific error messages that distinguish between incorrect usernames and passwords.
    - Improved security practices now use generic error messages to prevent such enumeration.

### Example Commands and Tools
- **robots.txt**: Access by adding `/robots.txt` to the website URL.
- **DirBuster**: Brute force browsing tool by OWASP.
- **CeWL**: Custom word list generator for Kali Linux.
  `cewl -d 1 -m 6 -w wordlist.txt https://example.com`

Web Enumeration Commands:

- Use tools like Nmap with specific scripts for website enumeration.
- Analyze user enumeration through trial and error with login attempts.

Practical Application
- Reconnaissance Example: Visiting diontraining.com/robots.txt reveals the site's use of WordPress by the presence of /wp-admin.
- User Enumeration: Attempting to log in with an invalid username and password on various sites to distinguish between invalid usernames and passwords.

#

# Detecting and Evading Defenses (OBJ 2.2)

# Lesson Summary: Importance of Detecting Defenses During Active Reconnaissance

## Introduction
In this lesson, we will discuss the importance of detecting defenses during active reconnaissance to evade them during the attack and exploitation phases. Key defenses include load balancers, firewalls, web application firewalls, and antivirus software.

## Load Balancers
- **Function**: Distribute traffic across multiple servers.
- **Detection**: Use the Load Balancing Detector (LBD) tool in Kali Linux.
  - Example: `lbd example.com`
- **Impact**: Can cause inconsistent scan results by directing requests to different servers. (False positive and False negative)

## Firewalls
- **Function**: Monitor and filter network traffic based on security policies.
- **Detection**: Perform a trace route. Non-responses (stars) indicate a firewall.
- **Tool**: Firewalk in Kali Linux.
  - Example: `firewalk -F 80 -n -p TCP example.com`
- **Operation**: Identifies firewall ACL rules by sending packets with specific TTL values.

## Web Application Firewalls (WAF)
- **Function**: Monitor and prevent attacks on web applications.
- **Detection**: Look for personalized cookies, altered headers, or explicit block messages.
- **Evasion**: Use obfuscation techniques to bypass detection.

## Antivirus Software
- **Function**: Prevent, detect, and delete viruses and malware.
- **Challenges**: Detects and blocks malicious payloads during attacks.
- **Evasion Techniques**:
  - **Metamorphic Virus**: Changes its code as it propagates.
  - **Obfuscation**: Modify the code to alter signatures.
  - **Fileless Malware**: Use OS-embedded functions (e.g., PowerShell).
  - **Encryption**: Encrypt payloads and use a stub to decrypt and execute them on the victim's machine.

## Conclusion
Detecting load balancers, firewalls, WAFs, and antivirus software during the reconnaissance phase is crucial for planning evasion strategies during attacks and exploitation.

#

# Packet Crafting (OBJ 2.2)


As a penetration tester, manipulating TCP/IP in a network, known as packet crafting, is essential. Packet crafting involves generating network packets with specific data content defined by the attacker or tester. These crafted packets are used for diagnostics, probing attacks, and testing network defenses and firewalls. Two commonly used tools for packet crafting are Hping and Scapy.

## When to Craft Packets

- **Testing Firewalls**: Setting unusual TCP flags to see how a firewall responds.
  - Example: Using a "Christmas tree" packet (FIN, URG, and PSH flags set).
- **Fragmenting Packets**: Breaking packets into smaller pieces to evade intrusion detection/prevention systems.
- **Denial of Service (DoS)**: Creating fragmented packets to consume system resources, potentially causing a DoS.

## Goals of Packet Crafting

- Use as few packets as possible.
- Be silent and sneaky to evade detection.

## Stages of Packet Crafting

1. **Assemble**: Create the packet to be sent.
2. **Edit**: Modify the packet's contents.
3. **Play**: Send the packet onto the network.
4. **Decode**: Capture and analyze the traffic using a packet analyzer like Wireshark.

## Tools for Packet Crafting

### Hping

Hping is an open-source spoofing tool used for packet crafting and manipulation. It offers various functions such as:

- **Host and Port Detection & Firewall Testing**: Similar to Nmap, using SYN or ACK packets.
  - `hping3 -S -p 80 -c1 192.168.1.1` = Send 1 SYN packet to port 80.
  - `hping3 -A -p 80 -c1 192.168.1.1` = Send 1 ACK packet to port 80.
- **Timestamping**: Determine system uptime.
  - Example: `hping3 -c2 -S -p80 --tcp-timestamp 192.168.1.1` = Send 2 SYN packets to port 80 to determine uptime.
- **Traceroute**: Perform traces using TCP or UDP when ICMP is blocked.
  - Example: `hping3 --traceroute -V -1 www.example.com` =
- **Fragmentation**: Evade detection by sending fragmented packets for later reassembly.
- **Denial of Service (DoS)**: Flood-based attacks from randomized source IPs.
  - Example: Crafting oversized packets for a "ping of death" attack.

### Scapy

Scapy is a powerful, interactive packet manipulation tool that can replace many functions of Hping, Nmap, and other tools. Scapy can:

- Generate and manipulate packets.
- Perform network scanning and discovery.
- Act as a packet sniffer.

**Usage**: Scapy runs on Python, with Scapy3 compatible with Python3. Basic usage involves defining and sending packets, receiving answers, and analyzing packet pairs.

- **Command Examples**:
  - `scapy3 -h` for usage options.
  - `scapy3 -S` for a session file.
  - `scapy3 -C` to not read the startup file.

For more details on using Scapy, additional research and online walkthroughs are recommended. While Scapy's usage isn't covered in certification exams, its role as a packet crafting tool is important to understand.

#

# Eavesdropping (OBJ 2.2)

### Active Reconnaissance: Electronic Surveillance and Eavesdropping

**Eavesdropping**:
- Act of secretly listening to private conversations to gather information without consent.
- Methods:
  - **Non-Technical**: Social engineering, e.g., listening to system administrators at a bar.
  - **Technical**:
    - Placing a network tap on an organization's connection.
    - Conducting on-path attacks to reroute traffic.
    - Setting up rogue wireless access points.
    - Joining wireless networks in promiscuous mode to capture traffic.

**Technical Eavesdropping Goals**:
- Capture information from data packets crossing the network.
- Ensure eavesdropping is within the engagement scope.

**Wireless Devices**:
- Targets for eavesdropping using specialized equipment to capture radio frequencies.
- Devices include cell phones, Bluetooth devices, NFC devices.
- Captured data can be analyzed if encryption is cracked.

**Network Traffic Capture (Packet Sniffing)**:
- Captures all data packets sent over the targeted network.
- Tools: Wireshark, TCPDump (protocol analyzers).
- Network card must be in promiscuous mode to capture all traffic on the network segment.
- Captured packets are stored in a PCAP file for offline analysis.

**Protocol Analyzers**:
- Specialized software that collects raw network packets.
- Helpful for troubleshooting network issues and assessing security.
- Wireshark is the most widely used protocol analyzer with a GUI.
- Can decrypt some vulnerable encryption protocols.

**Penetration Testing**:
- Packet sniffing proves or disproves statements made by system administrators.
- Easier to capture information on wireless networks compared to switch-based networks.
- Switch-based networks require a SPAN or mirrored port for comprehensive traffic capture.
- Network attacks like overloading CAM tables may be needed but are noisier and easier to detect.

**Encryption and Metadata**:
- Encryption protects data in transit, but metadata in packet headers remains useful.
- Metadata includes source/destination IPs, ports, protocols, and data volume.
- Analysis of encrypted traffic can reveal patterns, such as offsite backups or VPN traffic.

**Flow Analysis**:
- Identifies network communication patterns and potential attack vectors.
- Tools like NetFlow visualize metadata and highlight abnormal traffic.
- Useful for detecting data exfiltration, malware beaconing, and more.

**Conclusion**:
- Protocol analyzers provide insights into network sessions, identify malware connections, and reveal vulnerabilities.
- They are exceptional tools for comprehensive network security assessment during penetration testing engagements.

#

# Wardriving (OBJ 2.2)

### Active Reconnaissance: Wardriving and War Walking

**Wardriving**:
- Focuses on detecting wireless networks by driving around near a facility.
- Aims to find open and encrypted wireless access points for potential attacks.
- **War Walking**: Similar to wardriving, but involves walking around with a backpack to gather information about wireless networks.

**Wireless Network Security**:
- Wireless networks are generally less secure than wired networks due to the open nature of wireless communication.
- Security has improved with updates like WPA3, but vulnerabilities persist.
- Attackers and penetration testers continuously seek ways to overcome these protections.

**Conducting Wardriving/War Walking**:
- Search for access points and document their locations on a map.
- Look for open or rogue access points, and assess their security.
- Verify if access points are adequately protected, especially distinguishing between guest and business networks.

**Tools and Techniques**:
- **Wigle**: An open-source tool for mapping and indexing open access points.
- **Antennas**:
  - **dBi** (decibels per isotropic): Measures antenna strength (e.g., 2 dBi, 5 dBi, 9 dBi).
  - **Types**:
    - **Omnidirectional**: Picks up signals in all directions.
    - **Bidirectional**: Focuses on two directions.
    - **Unidirectional**: Focuses on one direction for longer distances.

**Signal to Noise Ratio (SNR)**:
- Measures the strength of the wireless signal compared to background noise.
- Low SNR indicates a need for a stronger antenna or closer proximity to the network source.

**Other Wireless Networks**:
- **Microwave and Satellite Links**: 
  - Used for high-speed internet and long-distance communication.
  - Can be intercepted for data capture, but must be done discreetly to avoid detection.

**Conclusion**:
- **Wardriving** and **war walking** help identify and assess wireless networks.
- Use appropriate antennas and tools to gather and analyze network data.
- Consider other wireless technologies beyond traditional WiFi for comprehensive network assessments.

#

# DNS and ARP Analysis (OBJ 2.3)


# Understanding DNS and ARP

## Overview
This lesson explains how DNS and ARP protocols work, focusing on packet analysis using Cisco Packet Tracer. Understanding these protocols is crucial for analyzing network traffic, especially in attacks and exploits.

## Network Setup
- **Sample Network:**
  - Client and local DNS server connected to **Switch 0**.
  - Switch 0 connected to a company's router.
  - The company's router has a serial connection to an **Internet Router**.
  - **Internet Router** represents the wider internet.
  - **Dion Training Router** connects to the internal network.
  - **Switch 1** connects to two devices:
    - `authority.diontraining.com` (Internal DNS server)
    - `server.diontraining.com` (Web server)

## Initial DNS and ARP State
- All DNS servers start with empty caches.

## DNS Resolution Process
1. **Client Request:**
   - Client requests `diontraining.com` through a web browser.
   - ARP packet sent to determine MAC address of the DNS server (`10.0.0.3`).

2. **ARP Process:**
   - Client broadcasts ARP packet.
   - Switch forwards ARP to local DNS server and company router.
   - Local DNS server responds with its MAC address.
   - Client learns the MAC address and sends DNS request to local DNS server.

3. **DNS Lookup:**
   - Local DNS server checks its cache and finds it empty.
   - Requests information from the root DNS server via the company router.
   - Root DNS server directs the request to the `.com` top-level domain server (`10.2.0.2`).

4. **Root DNS Server Response:**
   - Top-level domain server (root) responds with the authoritative DNS server for `diontraining.com` (`10.4.0.2`).
   - Local DNS server sends a query to `authority.diontraining.com` to resolve `diontraining.com`.

5. **Authoritative DNS Response:**
   - `authority.diontraining.com` has an A record for `diontraining.com` pointing to `10.4.0.3`.
   - Local DNS server caches the result and responds to the client with the IP address.

6. **Client Traffic:**
   - Client receives the IP address and sends HTTP requests to `server.diontraining.com` (`10.4.0.3`).
   - ARP process is repeated to resolve the MAC address of `10.4.0.3`.

## Conclusion
- **Cache Updates:**
  - Root and local DNS servers cache the resolved IP addresses.
  - Cached records improve lookup efficiency for future requests.

- **Revalidating Cache:**
  - Cached records are revalidated based on TTL (Time To Live).

By understanding DNS and ARP, you can effectively analyze network traffic and troubleshoot network issues.

#

# Network Traffic Analysis (OBJ 2.3)

# Network Traffic Analysis with Wireshark and tcpdump

## Overview
This lesson covers basic network traffic analysis using Wireshark and tcpdump. The goal is to understand how to analyze packet captures, identify services, ports, protocols, and potential vulnerabilities.

## Key Points

### Exam Preparation
- **Tools:** Wireshark, tcpdump, or similar tools.
- **Tasks:** Analyze packet captures to identify services, ports, protocols, and vulnerabilities.

### Wireshark Analysis
1. **Starting Point:**
   - Open a packet capture file in Wireshark.
   - Example: An HTTP connection showing the request and response between a client and a server.

2. **Packet Breakdown:**
   - **Frame (Layer 2):** Contains MAC addresses. Example: Ethernet protocol.
   - **IPv4 (Layer 3):** Contains source and destination IP addresses.
   - **TCP (Layer 4):** Contains TCP details such as flags and ports.
   - **Application Layer (Layer 7):** Shows data like HTTP requests or Telnet commands.

3. **Example Analysis:**
   - **HTTP Request:** Shows GET request and webpage data.
   - **FTP Traffic:** Displays file transfer data and port usage.
   - **Telnet Session:** Reveals remote command execution and user credentials.

4. **Stream Analysis:**
   - Follow streams in Wireshark to view entire conversations and data exchanges.

### tcpdump Analysis
1. **Introduction:**
   - Text-based tool for capturing and analyzing network traffic.
   - Use `sudo tcpdump -i <interface>` to start capturing packets.

2. **Capturing Traffic:**
   - **Live Capture:** View real-time traffic. Example: `sudo tcpdump -i en0`.
   - **Saving to File:** Use `-w <filename>` to save captures. Example: `sudo tcpdump -i en0 -w host130.pcap`.

3. **Analyzing Captured Data:**
   - **Reading from File:** Use `-r <filename>` to read saved captures. Example: `sudo tcpdump -r host130.pcap`.
   - **Filtering:** Apply filters to view specific traffic. Example: `sudo tcpdump src <IP> -r host130.pcap`.
   - **Hex and ASCII Display:** Use `-x` to show packet contents in hex and ASCII.

4. **Filtering Strategies:**
   - **During Collection:** Filter live traffic to reduce data volume.
   - **After Collection:** Filter saved data for detailed analysis.

### Additional Resources
- **tcpdump Manual:** Use `man tcpdump` for detailed options and filtering techniques.

## Conclusion
Understanding Wireshark and tcpdump allows effective analysis of network traffic, helping to identify services, protocols, and potential vulnerabilities. Filtering and analyzing packets provide insights into network activities and security issues.
