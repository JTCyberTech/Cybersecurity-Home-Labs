# Scanning and Enumeration (OBJ 2.2 and 2.3)

## Overview

After conducting initial footprinting and passive reconnaissance, the next step in penetration testing involves active reconnaissance. This process includes scanning and enumerating the target organization's systems to identify hosts, open ports, services, users, domain names, and URLs.

## Types of Scans

### Discovery Scan
- **Purpose:** Identify hosts that are online and determine open ports and services.
- **Methods:** 
  - **Ping Scan:** Identifies online hosts within a network.
  - **Port Scan:** Determines which ports and services are open on a host.

### Enumeration
- **Purpose:** Gather detailed information about identified hosts and their open ports.
- **Methods:** 
  - **Tools:** Nmap (command line) and Zenmap (GUI).
  - **Process:** 
    - Conduct a ping scan to find online hosts.
    - Perform a quick scan to identify open ports.
    - Execute an intensive scan to determine running services and their versions.

## Scanning Tools

### Nmap
- **Description:** A command line tool for various types of scans.
- **Capabilities:** 
  - Syntax-based setup for different scans.
  - Conducts ping scans, quick scans, and intense scans.

### Zenmap
- **Description:** A graphical interface for Nmap.
- **Capabilities:** 
  - Dropdown menus for selecting scan types.
  - Easy configuration of scans via domain names or IP ranges.

## Detailed Enumeration and Fingerprinting

### Intensive Scanning
- **Process:** 
  - Identify services running on open ports.
  - Determine exact software versions.
  - Example: Discover vsftpd version 2.3.4 running on port 21.

### Operating System Identification
- **Method:** Analyze system responses to queries.
- **Tools:** Zenmap, Nmap.
- **Example:** Identify a target system as Windows XP with specific service packs.

### Manual Banner Grabbing
- **Tools:** Netcat, wget, telnet.
- **Process:** 
  - Connect to a port and observe the service's response.
  - Example: Use Netcat to identify Apache web server version 2.2.16 on Debian Linux.

- `GET/HTTP/1.1`
- `wget <domain name or IP address> -S` 

### Packet Crafting
- **Tools:** Nmap, Zenmap, hping, Netcat, Ncat.
- **Process:** 
  - Modify packet headers to elicit specific responses.
  - Example: Use hping to send crafted SYN packets and analyze responses in Wireshark.

- `Nmap -sV <target domain or IP> -p <port number>`
- `hping3 --syn -p 80 192.168.1.15`

### Packet Analysis
- **Tool:** Wireshark.
- **Process:** 
  - Capture and analyze network packets.
  - Example: Identify a Microsoft ESMTP server and its software version.

## Summary

- **Scanning:** A generic process to identify online hosts and open ports.
- **Enumeration:** A more detailed process to gather information about services and software versions.
- **Fingerprinting:** The most detailed process to capture specific information about hosts or services.

By using tools like Nmap, Zenmap, Netcat, and Wireshark, penetration testers can conduct thorough scanning, enumeration, and fingerprinting to identify vulnerabilities and plan their exploitation strategies effectively.

#

# Conducting Enumeration (OBJ 2.3)

# Using Zenmap for Scanning and Enumeration

In this video, I'm going to demonstrate how to use Zenmap to conduct scanning and enumeration. For this example, I am connected directly to the local area network of my victim machines.

## Initial Scan: Ping Scan
1. **Ping Scan Setup**: 
   - Target network: `192.168.56.0/24`
   - Zenmap shows the Nmap command syntax.
   - Profile selected: Ping scan (`-sn`).
2. **Ping Scan Execution**:
   - Click on **Scan**.
   - Results: 4 hosts up (server, DHCP server, 2 virtual machines, and Kali Linux box).

## Further Scans
1. **Quick Scan**:
   - Target machines: `192.168.56.100` and `192.168.56.101`.
   - Quick scan checks common ports.
   - Results for `101`: Several open ports indicating potential vulnerabilities.
   - Results for `100`: All ports filtered.
   - Identified services: FTP, SSH, Telnet, RPC bind, Samba.

2. **Intense Scan**:
   - Profile selected: Intense scan.
   - Targets: `192.168.56.100` and `192.168.56.101`.
   - Scans for open and closed ports and attempts basic enumeration.
   - Results for `101`: Detailed service versions (e.g., VSftpd, Apache, Samba).

## Analysis of Results
1. **Machine Identification**:
   - `101`: Likely a Linux machine with Microsoft services.
   - `100`: Windows machine with firewall blocking many ports.
   
2. **Firewall Configuration Check**:
   - Windows firewall settings checked.
   - Exception for file and print sharing enabled.

3. **Rescan of Windows Machine**:
   - Quick scan after firewall exception.
   - Identified open ports: `139` and `445`.

4. **Detailed Enumeration**:
   - Intense scan on `100`.
   - Identified OS: Windows XP or 2000.
   - Additional information: NetBIOS details, SMB, trace route.

## Conclusion
- **Scanning Strategy**:
  - **Quiet Scans**: Minimal detection, realistic threat emulation.
  - **Loud Scans**: High detection, easier defender training.
  - Choice depends on assessment goals and method during the hack.

- **Tool Utilization**:
  - Understanding and customizing tools like Zenmap/Nmap for specific needs is crucial for effective scanning and enumeration.

#

# Other Enumeration (OBJ 2.2 and 2.3)

# Enumeration in Cybersecurity

When conducting enumeration, you're gathering detailed information on various targets within an organization. Enumeration typically focuses on five key areas: hosts, services, domains, users, and URLs. During the attacks and exploits phase, you'll return to enumeration to expand your search from inside the network once you've gained an initial foothold. Here's a quick look at the type of information you can gather during active reconnaissance efforts:

## 1. Hosts
A host can be any server, workstation, client, mobile device, tablet, IoT device, or networking device like switches, routers, or access points. Basic host enumeration can be done using tools like Zenmap and Nmap for ping scans and port scans. 

If you have network access (e.g., emulating an insider threat), you can use Windows command line tools such as:
- `net view`: Lists network shares from the workstation.
- `arp -a`: Displays the ARP cache with MAC addresses of machines recently communicated with.
- `ipconfig /displaydns`: Shows recently resolved DNS names.

For Linux hosts, use:
- `finger`: Views a user's directory, login name, and idle time.
- `uname -a`: Displays OS name and version.
- `env`: Lists all environmental variables.

## 2. Services
Enumerating services provides details about a given host. Nmap can conduct intensive scans to identify services running on open ports. For instance, discovering port 80 open indicates a web server, but further enumeration is needed to identify the software (e.g., Apache, IIS, NGINX) and its version. 

## 3. Domains
When referring to domain enumeration, it pertains to a Windows domain, not a website domain or DNS entry. Active Directory (AD) is used to connect hosts to servers and resources using Kerberos authentication. Enumeration involves understanding the domain structure, including Organizational Units (OUs), domain trust relationships, and user/group permissions. Tools like PowerShell can be used:
- `Get-NetDomain`: Lists the current logged-in user's domain.
- `Get-NetLoggedon`: Lists all users logged into a given computer.

## 4. Users
Enumerating users includes identifying groups they belong to, as this defines their access rights and permissions. If you have a user's credentials:
- `Get-NetGroupMember`: Lists domain members of a given group.
- `net user`: Lists all users on a given machine.
- `net groups`: Lists all groups on a machine.

## 5. URLs
Enumerating URLs helps gain more details about web servers or applications running on those URLs. Nmap's scripting engine can be used:
- `nmap --script=http-enum <target URL>`: Returns information about the services and applications running on the web server, like CMS systems (Drupal, Joomla, WordPress).

This gathered information aids in planning future attacks and exploits during the engagement's third stage.

#

# Website Reconnaissance (OBJ 2.3)

## Website Reconnaissance and Enumeration

### Importance of Website Reconnaissance
Organizations invest heavily in their websites to reach new customers and sell products. Consequently, penetration tests often involve website reconnaissance and attacks. 

### Key Areas of Focus
1. **Software and Server Information**:
    - Determine the type of software running the website (e.g., CMS like WordPress, Drupal, Joomla).
    - Identify the operating system and whether the server is hosted by the organization or a third-party cloud provider.
    - Discover server resources and hidden information exposed on the website.

2. **Website Code and Content Management Systems (CMS)**:
    - Websites are either custom-built using HTML, CSS, JavaScript, etc., or built on CMS platforms.
    - WordPress is the most popular CMS, running 62% of CMS-based websites and 37% of all websites.
    - Identifying the CMS helps in finding specific vulnerabilities for exploitation.

3. **Common Vulnerabilities in Custom-Built Websites**:
    - SQL injections, XML injections, cross-site scripting, and caching server attacks.
    - Identify functions for e-commerce, content searching, and user input for potential exploits.

4. **Website Crawling and Forced Browsing**:
    - Use crawling to find all pages, including hidden ones not linked directly.
    - **robots.txt** file: Check this file for directories the site owners don't want crawlers to index.
    - Tools like DirBuster perform brute force web crawling to discover hidden data.

5. **Web Scraping**:
    - Extract data using automation or manual processes (e.g., tools like CeWL for generating word lists for password cracking).
    - Useful for gathering information on email addresses and potential password words related to the business or individuals.

6. **Enumeration Techniques**:
    - Check for valid user accounts by entering usernames and observing error messages.
    - Look for specific error messages that distinguish between incorrect usernames and passwords.
    - Improved security practices now use generic error messages to prevent such enumeration.

### Example Commands and Tools
- **robots.txt**: Access by adding `/robots.txt` to the website URL.
- **DirBuster**: Brute force browsing tool by OWASP.
- **CeWL**: Custom word list generator for Kali Linux.
  `cewl -d 1 -m 6 -w wordlist.txt https://example.com`

Web Enumeration Commands:

- Use tools like Nmap with specific scripts for website enumeration.
- Analyze user enumeration through trial and error with login attempts.

Practical Application
- Reconnaissance Example: Visiting diontraining.com/robots.txt reveals the site's use of WordPress by the presence of /wp-admin.
- User Enumeration: Attempting to log in with an invalid username and password on various sites to distinguish between invalid usernames and passwords.

#

# Detecting and Evading Defenses (OBJ 2.2)

# Lesson Summary: Importance of Detecting Defenses During Active Reconnaissance

## Introduction
In this lesson, we will discuss the importance of detecting defenses during active reconnaissance to evade them during the attack and exploitation phases. Key defenses include load balancers, firewalls, web application firewalls, and antivirus software.

## Load Balancers
- **Function**: Distribute traffic across multiple servers.
- **Detection**: Use the Load Balancing Detector (LBD) tool in Kali Linux.
  - Example: `lbd example.com`
- **Impact**: Can cause inconsistent scan results by directing requests to different servers.

## Firewalls
- **Function**: Monitor and filter network traffic based on security policies.
- **Detection**: Perform a trace route. Non-responses (stars) indicate a firewall.
- **Tool**: Firewalk in Kali Linux.
  - Example: `firewalk -F 80 -n -p TCP example.com`
- **Operation**: Identifies firewall ACL rules by sending packets with specific TTL values.

## Web Application Firewalls (WAF)
- **Function**: Monitor and prevent attacks on web applications.
- **Detection**: Look for personalized cookies, altered headers, or explicit block messages.
- **Evasion**: Use obfuscation techniques to bypass detection.

## Antivirus Software
- **Function**: Prevent, detect, and delete viruses and malware.
- **Challenges**: Detects and blocks malicious payloads during attacks.
- **Evasion Techniques**:
  - **Metamorphic Virus**: Changes its code as it propagates.
  - **Obfuscation**: Modify the code to alter signatures.
  - **Fileless Malware**: Use OS-embedded functions (e.g., PowerShell).
  - **Encryption**: Encrypt payloads and use a stub to decrypt and execute them on the victim's machine.

## Conclusion
Detecting load balancers, firewalls, WAFs, and antivirus software during the reconnaissance phase is crucial for planning evasion strategies during attacks and exploitation.
