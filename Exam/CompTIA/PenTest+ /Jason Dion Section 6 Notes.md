# Vulnerability Scanning (OBJ 2.3 and 2.4)

## Vulnerability Scanning

In this section of the course, we'll discuss vulnerability scanning, the second part of the information gathering and vulnerability scanning stage of our engagement. Up until this point, we've conducted both passive and active reconnaissance. Now, we'll identify where our targets are most vulnerable to determine our plan for the upcoming attacks and exploits phase.

### What is Vulnerability Scanning?

Vulnerability scanning is the process of assessing a computer, server, network, or application for known weaknesses. To conduct a vulnerability scan, we use specialized software known as a vulnerability scanner. The scanning process includes:

- Detecting and classifying system weaknesses in assets
- Creating a report of identified vulnerabilities
- Providing recommendations for mitigating these vulnerabilities

### Course Objectives

This section focuses on completing the remaining objectives in domain two, Information Gathering and Vulnerability Scanning:

- **Objective 2.3**: Given a scenario, analyze the results of a reconnaissance exercise.
- **Objective 2.4**: Given a scenario, perform vulnerability scanning.

### Topics Covered

- **Vulnerability Life Cycle**: Understanding how vulnerabilities are introduced into a computer, network, server, or application.
- **Conducting Vulnerability Scans**: The process and considerations for vulnerability scanning as a penetration tester.
- **Demonstration**: A practical demonstration of how a vulnerability scan is conducted and how to read the results.
- **Web Vulnerability Scans**: A deeper look into scanning web applications for potential coding errors.

Let's get started by jumping right into this section.

#

# Vulnerability Lifecycle (OBJ 2.3 and 2.4)

## Understanding Vulnerability Scanning

To better understand vulnerability scanning, it's crucial to grasp the life cycle of a vulnerability. Vulnerabilities can be either known or unknown (zero-day vulnerabilities). A vulnerability is any weakness in a system that can be exploited by a threat actor to gain unauthorized access. Exploiting a vulnerability allows threat actors to run malicious code, install malware, and steal sensitive data. Common exploitation methods include SQL injection, buffer overflow, and cross-site scripting attacks.

### Attack Surface

Vulnerabilities can exist in various areas within an organization's computer network, including clients, servers, and networking devices. Collectively, these areas are known as the attack surface. Reducing the attack surface is essential for protecting your network, which involves hardening the system by installing patches, shutting down unnecessary ports, and enhancing security configurations.

### Vulnerability Life Cycle

The vulnerability life cycle is a five-step process: 

1. **Discovery**: Identifying a potential vulnerability that an attacker can exploit. For example, finding a server missing a security patch.
2. **Coordinate**: Reporting the discovered vulnerability to the responsible entity (e.g., software vendor) so they can create a CVE and develop a patch.
3. **Mitigate**: The vendor or software designer devises a strategy to address the vulnerability, usually through a configuration change or security patch.
4. **Manage**: Implementing the security patch or configuration change and testing the system to ensure the vulnerability is mitigated.
5. **Document**: Recording the results and lessons learned from the vulnerability management process.

### Zero-Day Vulnerabilities

Zero-day vulnerabilities are unknown vulnerabilities that haven't been reported to the manufacturer. Threat actors can exploit these vulnerabilities since there's no patch or mitigating controls available. Once a zero-day vulnerability is discovered in the wild, it enters the discovery phase, and mitigation measures, such as deploying a web application firewall, must be implemented until a permanent solution is available.

### Risk Management

When a vendor becomes aware of a vulnerability and releases a CVE, the risk gap occurs. This is the period when the public knows about the vulnerability, but no permanent solution exists yet. During this time, organizations need to implement additional mitigations until a full security patch is released to secure the system again.

### Importance of Patch Management

Effective patch management is crucial for maintaining security. Organizations often patch 90-95% of their systems, but the remaining 5-10% can still be vulnerable. Penetration testers can exploit these unpatched vulnerabilities during penetration tests, emphasizing the need for comprehensive patch management.

### Summary

Understanding the vulnerability life cycle and the importance of reducing the attack surface is vital for network defenders, system administrators, cybersecurity analysts, and penetration testers. Constantly seeking new ways to exploit systems and staying updated on zero-day vulnerabilities are essential practices for maintaining robust security.

#

# Vulnerability Scans (OBJ 2.3 and 2.4)

# Vulnerability Scanning

Vulnerability scanning is conducted by both network defenders and attackers. It is a specialized type of automated scan for hosts, systems, and networks to determine exactly what vulnerabilities exist on a given system.

## Perspectives

### Attacker's Perspective
When a vulnerability scan is conducted as part of a penetration test, it is viewed from an attacker's perspective to see what information can be figured out about a given network.

### Defender's Perspective
Cybersecurity analysts conduct vulnerability scans internally using many of the same tools but interpret the results from a defender's perspective. Vulnerability scanning and remediation fall under the vulnerability management program and are vital for maintaining strong network defenses.

## Tools for Vulnerability Scanning

There are many tools available for performing vulnerability scans, including:
- OpenVAS
- Nessus
- QualysGuard
- Nexpose
- Nmap (with additional vulnerability scanning scripts)

The effectiveness of these tools depends on proper configuration.

## Types of Vulnerability Scans

### Credentialed Scans
- Use authorized user or administrative account credentials
- Emulate an insider threat
- Provide more detailed information about vulnerabilities

### Non-Credentialed Scans
- Conducted without valid credentials
- Resemble an outside hacker's perspective

## Types of Scans

### Discovery Scans
- Least intrusive
- Used to identify which hosts are up and build a network map
- Conducted during active reconnaissance

### Full Vulnerability Scans
- More in-depth
- Check for open ports, running services, and associated vulnerabilities
- Noisy and easily detected by network defenders
- Usually conducted by network defenders weekly

### Stealth Scans
- Aim to go unnoticed by IDSs, IPSs, and network defenders
- Send SYN packets and analyze responses without completing the TCP handshake
- Less noisy but not as accurate as full scans

### Compliance Scans
- Conducted to meet laws, regulations, and policies
- Common example: PCI DSS compliance scans

## Tools Overview

### Nmap
- Great for network mapping, finding open ports, running services, and basic versioning
- Nmap scripting engine (NSE) can conduct basic vulnerability scans

### Nessus
- Popular vulnerability scanner
- Used for full scans and compliance scans
- Provides detailed reports with vulnerabilities, mitigation recommendations, and classifications

### Nexpose and QualysGuard
- Similar capabilities to Nessus
- Nexpose developed by Rapid7, the creators of Metasploit

### OpenVAS
- Open-source vulnerability scanner
- Free to use and source code available for review

### Nikto
- Web application vulnerability scanner
- Focuses on web application code and specific bugs
- Great for identifying vulnerabilities like SQL injection, directory traversal, and cross-site scripting attacks

## Conclusion

Vulnerability scanners are essential tools for both attackers and defenders. Proper configuration and understanding of the different types of scans are crucial for obtaining useful information and maintaining strong network security.

#

# Scanning Considerations (OBJ 2.3 and 2.4)

# Vulnerability Scanning Considerations

Before running a vulnerability scanner like Nmap, OpenVAS, Nessus, or Nikto, several considerations must be made to ensure effective and non-disruptive scanning.

## Time to Run Scans
- **Resource Usage:** Scanning consumes resources on both the scanning system and the target system.
- **Network Impact:** Simultaneous scanning of multiple machines can slow down the network.
- **Timing:** Choose optimal times for scans to minimize impact (e.g., avoid prime business hours and consider backup schedules).

## Protocols to Scan
- **Selection:** Decide which protocols and ports to scan to save time and resources.
- **Focus:** Minimize the number of ports and services to scan based on engagement goals and reconnaissance.

## Network Topology
- **Internal vs. External Scans:** Conduct scans from both inside and outside the local area network to get comprehensive results.
- **Compliance:** For PCI DSS compliance, both internal and external scans are necessary.

## Bandwidth Limitations
- **Scan Aggressiveness:** Adjust scan speed and aggressiveness based on the network's bandwidth capabilities.
- **Nmap Options:** Use Nmap’s -T syntax to control scan speed (e.g., -T5 for aggressive, -T1 for slow and stealthy).

## Query Throttling
- **Reduction:** Limit the number of queries to minimize bandwidth impact and avoid detection.
- **Timing:** Schedule scans to throttle queries during business hours and increase frequency outside of normal hours.

## Fragile and Non-Traditional Systems
- **Fragile Systems:** Identify and handle critical production servers carefully to avoid disruptions.
- **Specialist Systems:** Exempt or scan SCADA and ICS devices cautiously, preferably by specialists.

## Summary
Considerations include:
- **Time to run scans**
- **Protocols to scan**
- **Network topology**
- **Bandwidth limitations**
- **Query throttling**
- **Fragile and non-traditional systems**

By planning these aspects, you can avoid disruptions and detection during vulnerability scans.

#

# Nessus Scanning (OBJ 2.3 and 2.4)

# Using Nessus Vulnerability Scanning Tool

## Overview
This guide demonstrates how to use the Nessus vulnerability scanning tool, focusing on key features and steps.

## Accessing Nessus
1. **Load Nessus**: Open the Nessus web client running on your local machine (Windows in this example).
2. **Log In**: Access the tool by logging in with your credentials.

## Key Features

### Reports
- **View Reports**: Check completed reports under the Reports tab.
- **Compare Reports**: Compare historical reports to track vulnerability changes.
- **Download Reports**: Export reports for sharing with system administrators.

### Scans
- **Policies Tab**: Set up scan policies.
  - **Templates**: Use pre-configured templates (e.g., Web App Tests, PCI-DSS, Internal/External Network Scans).
  - **Custom Policies**: Create custom policies by clicking `Add`, naming it (e.g., "Windows Scan"), and configuring settings.
  - **Credentials**: Add credentials for more detailed, credentialed scans.
  - **Plugins**: Enable/disable specific plugins based on scan requirements.

### Creating and Running Scans
1. **Add New Scan**: Go to the Scan tab and click `Add`.
2. **Configure Scan**:
   - **Name**: Assign a name to the scan.
   - **Schedule**: Choose to run immediately or schedule it.
   - **Policy**: Select the policy created (e.g., "Windows Scan").
   - **Targets**: Enter IP addresses or ranges (e.g., 10.3.1.6, 10.3.2.3).
3. **Launch Scan**: Start the scan and monitor progress.

### Viewing Results
- **Scan Completion**: Check completed scans in the Reports tab.
- **Host View**: See which servers are most vulnerable.
- **Vulnerability Details**:
  - **Critical Vulnerabilities**: View detailed information about each vulnerability.
  - **Example**: MS08-067 – provides information on risk factors, patch links, and exploitation methods.

### Analyzing Results
- **Review Vulnerabilities**: Focus on critical vulnerabilities first.
- **Apply Fixes**: Provide findings to system administrators for patching.
- **Re-scan**: After applying fixes, perform a new scan to verify improvements.

## Conclusion
Using Nessus effectively involves configuring scan policies, running scans, and analyzing results to improve network security. Regular scans and updates help in maintaining a secure environment.

#

# OpenVas Scanning (OBJ 2.3 and 2.4)

# Assessing Scan Outputs with OpenVAS

## Overview
In this lesson, we will cover how to assess scan outputs using OpenVAS, including setting up scan accounts, configuring permissions, and analyzing scan results.

## Configuring Scan Accounts

1. **Create a Security Group**
   - Open DC1 and use Active Directory Users and Computers.
   - Right-click on Users > New > Group.
   - Name the group `sec-glo-scan`, set it as Global and Security type.
   - Click OK.

2. **Create a Scan User**
   - Right-click on User > New > User.
   - Enter full name and username as `scan`.
   - Set a strong password, uncheck "User must change password", and check "Password never expires".
   - Click OK.

3. **Add User to Group**
   - Right-click on the created user > Add to Group.
   - Type `sec-glo-scan`, check name, and click OK.

4. **Configure Group Policy**
   - Open Server Manager > Tools > Group Policy Management.
   - Right-click on the computer's OU container > Create a GPO in this domain and link it here.
   - Name it `515support Scanning Policy`.
   - Navigate to `Computer Configuration > Policies > Windows Settings > Security Settings > Local Policies > User Rights Assignment`.
   - Configure `Deny log on locally` and `Deny log on through Remote Desktop Services` by adding `sec-glo-scan`.
   - Configure Registry permissions by adding keys for `Users` and `Machine` with appropriate permissions for `sec-glo-scan`.

## Using OpenVAS

1. **Access OpenVAS**
   - Navigate to the OpenVAS web interface (e.g., `10.1.0.243`).
   - Log in with admin credentials.

2. **Configure Credentials**
   - Go to `Configuration > Credentials`.
   - Add a new credential named `sec-glo-scan`.
   - Set `Allow insecure use` to Yes, and enter `515support/scan` as the username and the corresponding password.
   - Click Save.

3. **Configure Scans**
   - Go to `Configuration > Targets` and create a new target:
     - Name: `515support-Host-Windows`.
     - Type: Manual.
     - Enter IP range (e.g., `10.1.0.0/24`), exclude specific IPs (e.g., `10.1.0.243`).
     - Set credentials to `sec-glo-scan` and click Save.
   - Go to `Configuration > Scan Configs` and review default scan configurations.

4. **Create and Run a Scan**
   - Go to `Tasks > New Task`.
   - Name the task (e.g., `515support-Host-Windows-Full`).
   - Select the target group and scan configuration (Full and Fast).
   - Click Save and then Start the scan.

5. **Review Scan Results**
   - Navigate to `Scan > Results`.
   - Analyze results by severity, keywords, and CVSS scores.
   - Use filters to find vulnerabilities for specific hosts or CVEs.
   - Example filters: `host=10.1.0.1` or `vulnerability~"4013389"`.

## Conclusion
Understanding how to configure and analyze scans with OpenVAS is crucial for identifying and addressing vulnerabilities. Regular practice with these tools helps in effectively securing your network and preparing for related exams.
