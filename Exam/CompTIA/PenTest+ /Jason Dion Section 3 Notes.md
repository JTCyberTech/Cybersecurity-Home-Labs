# Defining the Scope (OBJ 1.2)

## Defining the Scope for Penetration Testing Engagements

Defining the scope of a penetration testing engagement is crucial for effective and cost-efficient assessments. Here’s a summary of key points:

1. **Understand Engagement Objectives**: 
   - Align goals between the client and the tester to set a clear scope.
   
2. **Network Considerations**:
   - Assess both local networks and cloud-based infrastructures.
   - Address challenges of de-perimeterization and cloud migration.
   - Ensure a clear understanding of the client's architecture for known environment tests or guidelines for unknown environment tests.

3. **Cloud Services**:
   - Identify if cloud assets are in scope.
   - Categorize cloud services: 
     - **Software as a Service (SaaS)**: Complete solutions including hardware, OS, and software applications (e.g., Office 365).
     - **Infrastructure as a Service (IaaS)**: Provides hardware, OS, and backend server software with resource elasticity (e.g., cloud-based web server).
     - **Platform as a Service (PaaS)**: Includes hardware and software for specific services (e.g., development platforms for apps).

4. **Application Testing**:
   - Determine web or mobile applications to be tested.
   - Specify the scope by the number or percentage of web pages and user roles (regular, privileged, admin).
   - Understand specific scenarios and platforms (web, Android, iPhone).

5. **Target List**:
   - Identify and document assets in scope and out of scope, including locally hosted, cloud-hosted, and web/mobile applications.
   - Local network, Cloud Server, Web or nobile applications
  
#

# Adversary Emulation (OBJ 1.2) 

## Adversary Emulation and Threat Actor Types

### Importance of Adversary Emulation
Adversary emulation involves mimicking real-world threat actors' tactics, techniques, and procedures during penetration tests. This helps organizations understand their vulnerabilities and prepares them for potential attacks.

### Key Concepts

1. **Threat Actors**:
   - **Script Kiddie**: Least skilled, uses available tools without deep understanding.
   - **Insider Threat**: Employee/former employee with inside knowledge, can be highly dangerous.
   - **Competitor**: Rogue businesses conducting cyber espionage to steal data or damage reputation.
   - **Organized Crime**: Focused on financial gain, uses sophisticated attacks.
   - **Hacktivist**: Politically motivated hackers targeting organizations to advance their agendas.
   - **Nation State/APT**: Highly skilled, well-funded, conducts long-term, covert operations for political, economic, or military objectives.

2. **Threat Actor Tiers**:
   - **Tier 1**: Script kiddies using off-the-shelf tools.
   - **Tier 2**: Hacktivists using basic, self-developed tools.
   - **Tier 3**: Criminal hackers exploiting unknown vulnerabilities.
   - **Tier 4**: Organized crime with advanced technical proficiency.
   - **Tier 5**: Low-end APTs with state sponsorship but not direct state employment.
   - **Tier 6**: High-end APTs, state actors with extensive resources and capability for large-scale operations.

3. **Motivations**:
   - **Greed/Money**: Common among organized crime and ransomware attackers.
   - **Power/Revenge**: Seen in insider threats and some hacktivists.
   - **Thrills/Recognition**: Motivation for script kiddies.
   - **Political/Espionage**: Nation states aiming to further national interests.

### Application in Penetration Testing
- **Simulating Threat Actors**: Model penetration tests based on different threat actors' techniques.
- **Cost and Effort**: High-end simulations (e.g., APTs) require more resources than low-end ones (e.g., script kiddies).
- **Planning and Scoping**: Define objectives, and tailor the assessment to emulate specific threat actors based on the engagement's goals.

### Real-World Examples
- **APT-25**: Mimicking Chinese nation-state actors targeting defense contractors.
- **False Flag Attacks**: Nation states disguising their activities as those of other groups to mislead attribution (e.g., TV5MONDE cyber attack).

### Importance for Organizations
- **Building Defenses**: Knowledge of threat actors helps in developing targeted defenses.
- **Supply Chain Security**: Emphasis on using trusted suppliers to avoid sophisticated attacks (e.g., SolarWinds hack).

By understanding the types and motivations of threat actors, organizations can better prepare for and defend against potential cyber threats.

#

# Target List (OBJ 1.2)

# Importance of Target Selection in Planning and Scoping

As we proceed with planning and scoping for a penetration test, it is essential to identify valid targets for attack. This initial phase is crucial as it forms the foundation of our engagement. Here are the key considerations:

## Internal vs. External Targets
- **Internal Targets**: Located inside the organization's firewall; requires on-site access, VPN access, or exploiting a user’s computer within the network.
- **External Targets**: Publicly facing targets accessible over the internet, such as websites, web applications, email, or DNS servers.

## First Party vs. Third Party Hosted Assets
- **First Party Hosted**: Assets hosted by the organization in their data center.
- **Third Party Hosted**: Assets hosted by external service providers like AWS, Azure, or Google Cloud. Permissions from these providers are necessary.

## Physical Security
- **On-site Assessment**: Testing the physical security measures like guards, cameras, and entry controls.
- **Scope Definition**: Deciding which locations (main office, satellite offices) are included in the assessment.

## User Testing
- **Social Engineering**: Determining if phishing, spear phishing, or other social engineering attacks are allowed.
- **User Scope**: Identifying specific user groups (e.g., excluding executives) for targeting.

## Wireless Networks
- **SSID Identification**: Specifying which wireless networks are in scope.
- **Assessment Techniques**: Deciding on techniques like evil twin or rogue access points.

## Network and Asset Identification
- **IP Addresses and Ranges**: Defining in-scope assets based on IP addresses, network ranges, and ASNs.
- **Domain and Subdomains**: Listing which domains and subdomains are in scope.

## DNS and Server Permissions
- **DNS Targeting**: Clarifying if DNS servers can be modified or if DNS poisoning is allowed.
- **Server Assessment**: Deciding if web server software, databases, and SDKs are included.

## Applications and APIs
- **Application Focus**: Determining if single applications or all applications on a server are in scope.
- **Critical Applications**: Identifying mission-critical applications to exclude from the assessment to avoid downtime.

## Conclusion
Target selection during the planning and scoping phase is vital for a successful penetration test. It ensures that both the penetration tester and the client organization agree on the scope and objectives of the engagement, preventing misunderstandings and ensuring a comprehensive assessment.

#

# Identifying Restriction (OBJ 1.1)

Importance of Risk Tolerance in Penetration Testing

## Understanding Risk Tolerance
Every organization has a different risk tolerance threshold, which will significantly impact the planning, timing, and scope of your penetration testing engagement. This threshold determines how much risk the organization is willing to accept and influences the overall approach to the engagement.

## Impact on Engagement Planning

### Risk-Averse Organizations
- Require extra caution to avoid disruptions.
- May have a smaller scope and tightly controlled engagement.

### Higher Risk Tolerance
- Allows for a larger scope or faster tempo engagement.
- Penetration testers have more leeway in their activities.

## Four Risk Management Strategies
- **Avoid**: Tightly control engagement scope and tempo. Organizations may tightly control the engagement, including its scope and tempo, to prevent disruptions.
- **Transfer**: Move risk to another entity, e.g., making penetration testers responsible for any damages caused. Risk can be shifted to another entity, such as requiring the penetration tester to be responsible for fixing and paying for any system crashes.
- **Mitigate**: Conduct assessments during specific times to minimize impact. Limit testing to certain times or exclude specific days, like peak business hours, to minimize potential disruptions.
- **Accept**: Organizations with high risk tolerance may accept potential downtime or disruptions. High-risk tolerance organizations may allow testing at any time, accepting potential downtime.

## Scope and Timing Considerations
- **Impact on Operations**: Understand how disruptions might affect the organization. Assess the potential effects of testing failures, such as server downtime, and balance the need for thorough assessment against business continuity requirements.
- **In-Scope and Out-of-Scope Assets**: Clearly define which assets and systems are included or excluded. Specify included and excluded targets to align with the organization's risk tolerance, such as excluding critical systems like email or e-commerce servers.

## Scheduling and Timing

Engagement Duration: Determine how long the testing will occur and whether network defenders should be informed of the testing schedule.
Red Team/Blue Team Engagement: Decide if defenders should be aware of the attack plans or if a more realistic, stealthy approach is desired.
Scope Creep Management: Prevent scope creep by including clauses in the contract for handling changes and additional costs for expanding beyond the initial scope.

## Legal and Regulatory Considerations
- **Location-Based Restrictions**:
  - Be aware of laws and regulations in different countries, states, and cities.
  - Consult with legal counsel to ensure compliance.
- **Tool Restrictions**:
  - Some penetration testing tools are subject to export restrictions, e.g., encryption tools under the Wassenaar Arrangement.
  - Ensure compliance with export controls to avoid fines or imprisonment.

## Summary
Risk tolerance is a crucial factor in penetration testing engagements, affecting scope, timing, and methodology. Organizations must balance the need for thorough assessments with the potential impact on operations. Proper planning, clear communication, and legal compliance are essential to successful and ethical penetration testing.

#

# Rules of Engagment (OBJ 1.2)

# Defining Rules of Engagement for Penetration Testing

After clarifying the scope of the assessment, it is crucial to establish the Rules of Engagement (ROE) with your client. The ROE are the ground rules that both parties must adhere to during the penetration test. The key areas covered by the ROE include:

## Timeline
- **Timeline Definition:** The agreed-upon duration for the penetration test, including when it will occur and the total duration of the engagement.
- **Task Outline:** A detailed outline of tasks to be performed, their estimated durations, and who is responsible for each task within the penetration testing team.
- **Event Schedule:** A timeline provided to the trusted agent within the targeted organization to aid in deconfliction and obtain concurrence before executing the assessment.

## Locations
- **Onsite vs. Remote:** Whether the penetration testing team will be conducting attacks onsite or from a remote location.
- **Authorized Locations:** Specifying which locations are authorized to be targeted and which ones are considered off-limits and out of scope.
- **International Considerations:** Awareness of laws and regulations applicable in locations that cross international borders.

## Time Restrictions
- **Authorized Times:** Specifying certain times that the penetration tester is authorized or unauthorized to conduct their exploits and attacks.
- **Business Hours Testing:** Explaining the importance of conducting penetration tests during normal business hours to measure the organization’s reaction to an attack.

## Transparency
- **Awareness:** Identifying who in the target organization will be informed about the scheduled engagement.
- **Trusted Agent:** Designating an in-house staff member as a trusted agent to monitor and communicate directly with the penetration testing team.

## Boundaries
- **Inclusion and Exclusion:** Defining what systems and techniques are included and excluded from the assessment.
- **Social Engineering:** Specifying whether social engineering methods, such as phishing, are allowed.
- **Physical Security:** Confirming what physical security tests are authorized, such as whether the tester is allowed to climb fences.

By clearly defining the ROE, both the organization and the penetration tester can ensure a well-structured and agreed-upon framework for the penetration test, which helps in achieving the assessment objectives while respecting the boundaries set by the client.

#

# Assessment Types (OBJ 1.3)

# Types of Penetration Tests and Assessments

## Goals-Based Assessment
- **Purpose:** Achieve a specific goal, like breaking into a facility to test physical security.
- **Methods:** Use any technique, such as social engineering, piggybacking, tailgating, fence jumping, or lock picking, to achieve the goal.

## Objectives-Based Assessment
- **Purpose:** Ensure information remains secure.
- **Methods:** Utilize various techniques (physical methods, server-side exploits, phishing attacks) to access the information. Success is defined by achieving the objective once.

## Compliance-Based Assessment
- **Purpose:** Verify adherence to policies and regulations.
- **Examples:** PCI DSS, GDPR, HIPAA, Sarbanes-Oxley, GLBA compliance audits.
- **Methods:** Use a checklist to ensure policies (password policies, data isolation, network access, key management) are followed.

## Premerger Assessment
- **Purpose:** Conducted during due diligence before two companies merge.
- **Methods:** Assess the other company's network to determine if merging will weaken cybersecurity.

## Supply Chain Assessment
- **Purpose:** Ensure suppliers meet cybersecurity requirements.
- **Methods:** Penetration testers must obtain permission from both the client and the supplier. This is crucial as supply chains can be the weakest link in security.

## Red Team Assessment
- **Purpose:** Internal penetration testing to simulate real-world attacks.
- **Teams:**
  - **Red Team:** Offensive penetration testers.
  - **Blue Team:** Defensive network defenders.
  - **White Team:** Oversees the engagement, ensuring fairness and effectiveness.

## Strategies for Engagement
### Unknown Environment Testing
- **Purpose:** Simulate an external attack with no prior knowledge of the target.
- **Methods:** Information gathering, vulnerability scanning, and exploiting network resources like a real attacker.

### Partially Known Environment Testing
- **Purpose:** Simulate an insider threat with minimal knowledge.
- **Methods:** Testers receive limited information (e.g., IP ranges, user credentials) to perform the assessment.

### Known Environment Testing
- **Purpose:** Assess with full knowledge of the target.
- **Methods:** Testers receive detailed information (network diagrams, IP addresses, OS versions, source code) to focus on identifying and exploiting vulnerabilities.

By understanding and choosing the appropriate type and strategy of assessment, penetration testers can effectively evaluate and improve an organization's security posture.

#

# Validating the Scope (OBJ 1.2)

# Scope Validation in Penetration Testing

## Overview
After agreeing on the rules of engagement, assessment type, strategy, and scope, it's crucial to validate the scope with the client. This involves confirming all requirements, scope, and details before receiving final approval to proceed with information gathering and vulnerability scanning.

## Key Steps in Scope Validation
1. **Confirm Requirements and Scope**
   - Review all key areas from the statement of work and rules of engagement.
   - Ensure clarity on the in-scope target assets, out-of-scope items, and testing strategy (unknown, partially known, or known environment).
   - Discuss the timeline, working hour constraints, applicable laws, third-party involvement, and communication channels for updates.

2. **System Backups and Recovery Procedures**
   - Ensure the target organization has robust system backups and recovery procedures in place to recover operations if issues arise.

3. **Communication and Contacts**
   - Identify key contacts within the client organization for reporting issues, de-conflicting situations, or disclosing high-risk vulnerabilities.

4. **Allowed and Excluded Target Lists**
   - Establish a list of authorized (allowed) and unauthorized (excluded) targets for the engagement.

5. **Boundary Defenses and Allow Lists**
   - Understand the organization's boundary defenses (e.g., firewalls, intrusion prevention systems).
   - Determine if penetration testing systems should be placed on an allow list to bypass certain defenses, depending on the focus of the assessment (internal or external).

6. **Handling Detection and Blocking**
   - Plan for potential scenarios where penetration testing activities are detected and blocked.
   - Discuss with the client the possibility of unblocking systems or adding them to the allow list if necessary to complete the test objectives.

7. **Security Exceptions**
   - Consider any necessary exceptions to security controls, such as web application firewalls or network access controls, especially if these are not the primary focus of the test.

## Special Considerations
- **Certificate Pinning and NAC**
  - For networks requiring digital certificates for access, request an exception to allow penetration testers to connect without triggering security measures.

## Conclusion
Effective scope validation ensures clear communication and agreement between the penetration testing team and the client organization. It involves careful planning and negotiation to balance thorough testing with operational safety, adhering to agreed-upon terms and conditions.

#

# Limitations and Permission (OBJ 1.1 and 1.3)

# Penetration Testing Best Practices and Documentation

## 1. Confidentiality and Data Protection
- **Safeguard Confidential Information**: Protect sensitive data discovered during testing.
- **Notify Trusted Agents**: Inform the organization if accessing unintended network areas.
- **Prevent Unauthorized Disclosures**: Avoid accidental data leaks to limit liability.
- **Contractual Liability**: Ensure contracts include clauses to limit liability for accidental disclosures.

## 2. Contractual Compliance
- **Adhere to Requirements**: Follow guidelines in:
  - Statement of Work (SoW)
  - Master Service Agreements (MSA)
  - Service Level Agreements (SLA)
  - Non-Disclosure Agreements (NDA)
- **Include Disclaimers**: Add disclaimers and liability limitations in contracts.
- **Legal Review**: Contracts must be reviewed by legal counsel before signing.
- **Agreement on Terms**: Ensure all parties agree on terms before starting the engagement.

## 3. Professionalism and Time Management
- **Maintain Professionalism**: Uphold professionalism throughout the engagement.
- **Complete Tasks Efficiently**: Perform tasks quickly, effectively, and efficiently.
- **Detailed Documentation**: Keep thorough notes and records of all activities.
- **Good Time Management**: Manage time well during all phases:
  - Planning and Scoping
  - Information Gathering and Vulnerability Scanning
  - Reporting and Communication

## 4. Scope and Limitations
- **Adhere to Scope**: Follow the agreed-upon scope and rules of engagement strictly.
- **Perform Allowed Tests**: Conduct only those tests defined by the contractual documents.
- **No Scope Expansion**: Do not extend testing beyond the agreed scope without formal amendments.
- **Coordinate with Client**: Identify sensitive or mission-critical systems with the client.
- **Limit Invasiveness**: Minimize impact on critical systems.
- **Use Appropriate Tools**: Employ tools suited to the engagement type (e.g., PCI DSS, HIPAA, GDPR compliance).

## 5. Tool Usage and Restrictions
- **Approved Tools**: Use only tools approved by the client.
- **Tool Review**: Submit new tools for review and approval if not on the approved list.
- **Avoid Data Carryover**: Do not transfer data from one client’s network to another.
- **Respect Restrictions**: Adhere to technical or location-based restrictions imposed by the client.

## 6. Permission and Authorization
- **Written Permission**: Obtain written consent before starting any testing.
- **No Verbal Approvals**: Verbal approvals are not sufficient; ensure written documentation.
- **Document Permissions**: Clearly document and communicate all permissions and approvals.

## 7. Conclusion
- **Prioritize Safety and Legality**: Ensure all testing activities are conducted legally and safely.
- **Thorough Preparation**: Prepare adequately and comply with all contractual and legal requirements.
- **Clear Communication**: Maintain clear communication with the client to avoid misunderstandings and ensure a successful engagement.
