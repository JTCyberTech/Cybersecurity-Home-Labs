# CompTIA® PenTest+® Certification For Dummies®, 2nd Edition

# Chapter 4: Vulnerability Identification

Vulnerability = Weakness in a system that can be discovered and exploit to compromise the security system.

# Understanding Vulnerabilities 

Types of Vuln Scans

- Discovery Scan: Used to discover systems on network by performing ping scan and port scan to see which port is open.
  - Not a full vuln scan that look for vulnerabilities, Used to find system on network.
- Full Scan: Aggressive scan, performs many different test to identify vuln in system. Use large number of plug ins to perform different types of vuln check to check for SMTP, SNMP vuln.
- Stealth Scan: If you are hired by Org to do PenTest without the Org's Security team knowing, Hiding your presence, avoiding detection by the security team.
  - Techniques: Not scanning full IP range, scanning ports, Use multi source IP address to perform scan.
- Compliance Scan: Org that is governed by regulations for industry/business practices, perform vuln scan regular basis for regulations.
  - Need both internal and external scan.
  - External scan must be approved by approved scanning Vendor (ASV)
  - Vuln scan should run quarterly and after major change to environment.
  - If critical Vuln are found, must remediate and then new scan perform to validate the remediation have removed the vuln.

## Credentialed Vs. Non-Credentialed Scans

Should perform multi scans: At least once as non-cred user and once cred user (admin). Get different views on the system when doing both scans.

- Non-cred Vuln scan = Hacker POV should give you some vuln: ports open, maybe patches missing, will not see info such as password policies
- Cred Vuln Scan = Admin POV should give all information about the system's vuln: Vuln related to user account, group memebership, missing patches, password policy config setting.

## Application Scans

Used to perform an audit on application 

- Dynamic Analysis: Used to assess vuln in application by analyzing behavior of application while its running.
  - Not reviewing source code, reviewing the result of how application responds to input.
  - Perform in Blackbox PenTest
- Static Analysis: Given source code of Application, review the source code for vuln in application.
  - Perform in a Whitebox PenTest.

## Vuln Scan Consideration

- Timing of the Scan: Plan the best time to perfrom scan. Can stress outthe network and system being tested.
  - Perform during times when users will not epxerience negative effects of the test.
  - Be sure the systems and device that need to be tested are availabile.

- Protocol Used: Important to understand which protocols and applications are being used by Org so you can use the appropriate Plugins to detect vulnerabilities with protocols.

- Network Topology: Should have a network topology diagram to help understanding the target systems when vuln scanning.
  - Vuln scanner will have host discovery feature that can help you locate devices on the network and build network topology.
  - Understanding network topology of customer network will ensure you not to scan network outside the scope.
 
- Bandwidth Limitations: Vuln scan generates tons of network traffic, check to see if there are specific time of the day that have more bandwidth available to perform,

- Query Throtting: A technique to ensure your vuln scan does not have negative effect of overloading the systems and network -> Throttle the queries.
  - Throttle the queries: you are able to decrease or increase the frequency of the calls coming from the vuln scan
  - Ensureing system does not overburden with number of queries.
  - Increase amount of time it takes to perform Vuln scan.
 
- Fragile systems/ non-traditional assets: IoT, Vuln scan can have negative effect such as causing it to become unresponsive/ crash during vuln scan.
  - Common practice to create a test system out of image of the production system and run some trials on test system to see how it responds.

#

# Performing a Vulnerability SCan

## Running Nessus

Nessus: 
- Scan page: allow you to see your past vuln scans and run new scans.
- Settings page: allows you to modify the configuration of Nessus; # of hosts and ports that are scanned at the same time. Modify setting to improve performance of the scan/throttle the scan.

Type of Scan:
- Host Disovery: Discover live systems on network and open ports on those systems.
- Basic Network Scan: Allow to perform vuln scan on systems using default setting and pre defined plug-ins that determine types of checks scan will do.
- Advanced Scan: Similar to basic network scan, but allows you to customerize plugins scan uses (determines the vuln to check for).
- Malware Scan: Remote Windows and Linux Systems to see if there is malware present on systems.
- Web Application Test: Used to assses common vuln on websites.
- Internal PCI network Scan: Compliance scan, Org must perform vuln scans to satisfy compliance to regulations; PCI DSS regulations.

## Using Other Vuln Scanners

Nikto: Web Application vuln scanner come with Kali Linux; Command line tool used to assess the securtiy of different websites.
- List of Parameters for Nikto: `nikto --help` command.
- Nikto perform web culn scan on system with IP "192.168.67.134" on port "80", Store result in an output file: `nikto_scan` format: plain text file
  - `nikto -h 192.168.67.134 -p 80 -o nikto_scan -F txt`
 
SQLmap: Open-Source PenTesting tool used to perform SQLi attacks.
- It's important to check for common SQLi attacks on Web App that connects to a database.
- `sqlmap -u http://urlofpage/page.php?id=2 --dbs`
  - Identify page in your web app that displays data and note the URL, --dbs parameter = display information about the underlining database; type of database system it is/ database name if SQLi is successful.
- `sqlmap -u http://urlofpage/page.php?id=2 -D databasename --tables`
  - Retrieve list of tables from the database, gives a list of table names that exist in database if SQLi attack is successful.
- `sqlmap -u http://urlofpage/page.php?id=2 -D databasename -T tablename --columns`
  - Display info about those tables such as columns that exist in a table.
- `sqlmap -u http://urlofpage/page.php?id=2 -D databasename -T tablename --dump`
  - Retrieve data from a single column, retrieve data that is store in the entire table.
 
#

# Analyzing Vulnerability Results

Severity of vuln is based on CVSS (Common Vulnerability Scoring System): Range from 0 to 10
- Low: No serious security issue; 0.0 - 3.9
- Medium: Could present a security issue; 4.0 - 6.9
- High: Presents a serious security issue; 7.0 to 9.9
- Critical: Presents a very serious security issue, should deal with it immediately; 10

## Understanding the CVSS base score

CVSS = Common Vulnerability Scoring System: Divided into three parts: 
- Version
- Metric to calculate Exploitablility
- Metric used to calculate Impact of Vulnerability

![image](https://github.com/user-attachments/assets/4cfe5ebd-e0ee-4304-8f27-4874fec33727)

Exploitability Metrics: Three Metrics: AV = Attack Vector; AC = Attack Complexity; Au = Authentication


Attack Vector: Measure how hackers executes the exploits; LAN
  - Local (L): Attacker must have physical access to the vuln system or local account.
  - Adjacent Network (A): Attacker must be connected to LAN in oder to exploit the vuln
  - Network (N): Attacker can exploit vuln from remote network; does not need to be on the same physical LAN.

![image](https://github.com/user-attachments/assets/3584d5e3-36dd-4d8a-aba9-3581fe617b15)

Attack Complexity: How easy or difficult it is to exploit the vulnerability; HML
  - High (H): Special conditions needed to be met in order to hack the vuln.
  - Medium (M): Some Conditions needed to be met in order to hack the vuln.
  - Low (L): Exploiting this vuln is not difficult; no special requirements.

![image](https://github.com/user-attachments/assets/14f24728-2065-4109-913b-488bf20f1970)

Authentication: Used to specify how many times the attacker would need to authenticate to the system to exploit the vuln.
  - Multiple (M): Attacker required to authenticate two or more times when performing the exploit.
  - Single (S): Attacker required to authenticate only once while exploiting the vulnerable system.
  - None (N): Attacker is not required to authenticate to the system at all to exploit the vulnerable system.

![image](https://github.com/user-attachments/assets/6a0e34a0-5c84-4957-b3e4-0114427015b8)


Impact Metrics: Used to identify what impact is of the exploit being performed on the: NPC Format
- Confidentiality (C)
- Integrity (I)
- Availability (A)

NPC = None, Partial, Complete

![image](https://github.com/user-attachments/assets/1377aaa6-6740-4707-8484-18ab3b442916)

#

## Prioritizing Activities

Once a list of Vuln is made; Challenge = prioritize which Vuln needed to be remediate first.
- Severity level: base it on the CVSS base score.
- Vulnerability Exposure: How exposed is this vulnerabiity
  - If vuln system is only available to small network segment; Not available to systems on the guest network or internet = Not priority.
  - If vuln system is exposed to guest network/ internet that is available to hacker outside your network = priority.
  - But take note that there might be internal threat actors within the Org.
- Criticality of the System: Type of system which vuln exists on; if vuln exposes sensitive info to untrusted sources.
  - if vuln is found on database server; allow access to sensitive Org data stored in database.
  - Systems should have a criticality level assigned to them.
- Statement of Work: SOW says under what circumstances PenTesters should stop the PenTest and report a vuln to the security team of Org.
  - There may be vulns that needed remediatin immediately before continuing the PenTest.
 
## Considerations for Analyzing Scan Results

Need to understand how the result of vuln scan might be affective to your Org and its security posture.


Asset Categorization: how critical system that has vuln? If its a critical system, you may want to prioritize remediation on that system first.
- Prioritize remediation on external system first as an attacker on internet can reach the system.
- Financial, Operational, Production Control Category have a priority level assisned.

Adjudication: making decision on whether vuln discovered is a false positive; flase positive is not common with Vuln scanner, its possible. Be sure to validate results.

Prioritization of Vulnerabilities: Biggest considerations to make with the Vuln scan result.
- If it exploits CIA, should typically take priority.
- Web App vuln: Invalid certification vs. Password found in HTML source code
  - Invalid Certification has highest risk: violation of Confidentiality (certificate is there to encrypt communication, but it is now invalid).
- Web App vuln: SQLi vs Cross-site scripting attack
  - SQLi = higher risk vuln because it could be responsible for allowing access to sensitive data in database or allow hacker to delete data (Violation of Availaility and Integrity).

## Common Themes

Vuln Scanner look for two main issues:
- Designed to identify vuln with the system and make observations about configuration of the system.
- Designed to identify lack of best practices being followed.
  - Detect too many Admin accounts; Do not have password policy configured.
 
Common Vuln, Observations, lack of best practices: 
- Missing patches: OS patches, patches for softwares running on system.
- Admin accounts: Vuln Scanner might report back if there are more than two admin accounts)
- Default Configuration: Report on default config setting that have not been modifed that should be modifed.
- Default Permission: Folder are not following the best practices; if default Windows permission are left unchanged, giving everyone (read access).
- Certificate Issues: When Scanning web app, Vuln scanner checks certificate used to encrypt communication and let you know if there are issues with the certificate.
- Web Application Vulnerabilities: Vuln Scanners will let you know if there are vuln with web app; Cross-site Scripting (XSS) or Cross site Request Forgery (XSRF) attack.


#

# Attacks and Weaknesses in Specialized Systems

Different Devices and products need to be tested beside Computers and Servers.

## Mobile Devices

Secure mobile devices and ensure Orgs are following best practice: autolocking devices, password protecting devices, encrypting storage, maintaining remote-wipe capabilities.

Attacks Against Mobile Devices:

- Reverse Engineering: Allows you to understand mobile applciation better. Dynamic analysis may not be possible due to encryption but you can analyze the binary code using static analysis tools.
- Sandbox Anaylsis: When application being tested are run in an isolated environment that emulates the environment in which the application was designed to run.
- Spamming: To send unsolicited messages to people.

Vulnerabilities to Mobile Devices:

- Insecure Storage: When developement team assume application code will not have access to data stored on the device.
  - Ensure strong encrpytion used on device and device has not been rooted.
- Passcode Vulnerabilities: Look for weak password to gain accesss to the device.
- Certificate Pinning: When you configure application to only accept certificate for specific systems.
- Using Known Vulnerable Components: Application should ensure any third party components that are referenced are secure.
- Patching Fragmentation: Practice of an Org selectively choose which patches to apply based on usage of product, may leave component vuln to attacks.
- Execution of Activities using Root: Rooting devices; process of jailbreaking device. Rooted device's storage encryption might not be secure.
- Overreach of permission: Applicatin request more permission than it needs to perform a job on the device. Need to be manually revoke the token once granted.
- Biometrics Integratins: Weaknesses in biometric functionality of a movile device.
- Business Logic Vulnerabilities: There may be vulnerabilities in core business logic that is called upon by the mobile application. Be sure to understand any dependencies an application has and verify the code of these dependencies.

Tools Used to Test Movile Device and Applications:

- Burp Suite: GUI tool enables PenTester to test security of Web App. Includes many features; web proxy for MiTM, web app security scanner for common SQLi, XSS, parameter manipulation.
- Drozer: Framework created by MWR Labs to assess the security of Android application on Android devices.
- Mobile Security Framework (MobSF): automates static analysis, dynamic analysis, malware analysis.
- Postman: Application that you can use to test RESTful APIs by enabling you to submit HTTP request to the API and view the respoonse.
- Ettercap: Free tool that can aid in MiTM attacks and enable you see all traffic between two systems.
- Frida: Application testing tool that enables you to intercept data sent and received by application and then inject code of your own to see how application responds.
- Objection: Exploration framework that works with Frida to explore areas of mobile device.
- Android SDK tools: Development and debugging tools enable deep review and analysis of an application.
- ApkX: command line tool used to decompile Android package files (.apk) written in Java.
- APK Studio: Suite of tools used to decompile Android Applications, edit the code and then recompile the application.

## Cloud Technologies

Another source of weaknesses that can be exploited.

Attacks on Cloud environments:

- Credential Harvesting: Occurs when attack obtains logon credentials of users; phishing attack.
- Account Takeover: Once attacker know cred of user's account, attacker can takeover the account and access data and services within the cloud.
- Privilege Escalation: Once attackers log in to cloud, might be able to perform privilege escalation where they exploit system in a way that givs them admin level privileges.
- Metadata Service Attack: Attacker obtain info about VMs configured in the cloud. With this info, attack can learn about the storageand network configuration of VM that aid the attack.
- Misconfigured Cloud Assets:
  - IAM (Identity and Access Management): Used for set of policies and technologies that work together to control what resources a user can access. Misconfiguration can allow user to access resources thet are not allowed.
  - Federation Misconfigurations: Federation services allow SSO function with other Orgs that your environment trusts. Users from third party Org would log on with their normal credentials to access your cloud application; open your application or cloud environment up to unintended parties.
  - Object Storage: Fail to secure the repository could give unauthorized access to the data.
  - Containerization Technologies: Container = a form of Virtualization technology that enables company to run application within isolated environment. Attacks against container can give access to applications hosted in the container.
  - Resource Exhaustion: Involves the attacker exploiting environment in such way that it cause cloud service, VM or application to crash, hang or responds poorly.
  - Cloud malware injection attacks: Attacker gains access to cloud and inserts malware as a module or VM that intercepts request from the user and then performs malicious actions; manipulating or stealing cloud user's data.
  - Denial of Service Attacks (DoS): Cause cloud service, application or VM to crash or perform poorly.
  - Side-Channel attacks: Information is exported off a system or environment using method other than normal channel of communication. Attacker can run VM that steals information from shared hardware resources such as CPU cache of hosting environment.
  - Direct-to-origin Attacks (D2O): Web App uses CDN (Content Delivery Network) in which website is cached on CDN servers that are spread throughout the world. CDNs are usually protected by web application firewalls. D2O is when attacker figure out the IP address of real website that sits behind CDN servers and sends the request to the origin server. The Origin server is not protected by WAFs that are protected by CDNs.
 
Tools: 
- Biggest tools used to understand vuln of cloud resources is using SDK (Software Development Kits). SDK allow deep review and analysis of an application.

## Internet of Things Devices (IoT)

Light Fixtures, Thermostats, Security Cameras.

IoT devices run on Bluetooth and Bluetooth Low Energy (BLE), device may be vulnerable to attacks against BLE and bluetooth.
- BLE: a wireless communication protocol that is designed to consume less power than original Bluetooth technology while still providing similar range.
- Attacks: Bluetooth Low Energy Spoofing Attack (BLESA); allows two devices that had previously been paired to skip authentication when reconnecting after falling out of range. Bypass connectin verification and send spoofed data to device.

Special Considerations of IoT devices: 

![image](https://github.com/user-attachments/assets/cbabc325-5ab4-4708-879a-dfd4bdae63f1)


Vulnerabiities of IoT Devices: 

![image](https://github.com/user-attachments/assets/d44270c0-fbab-4360-bab4-017b7594d496)


## Underlying Software Vulnerabilities

Lack of user input sanitization: Input sanitization should be performed on any data that is entered into an application. Input sanitization occurs when the developer blocks or escapes any potential malicious characters in the data input in order to help prevent an attack against the system.

Error messages and debug handling: Software applications sometimes do not debug or handle errors properly. You want to ensure that you trap errors and show generic error messages. Detailed error messages displayed by the application may help the attacker understand more about the environment and how to exploit it.

Injection vulnerabilities: A common method to exploit a system is to perform an injection attack, where code is inserted as input that enables the attacker to control how the application executes. For example, attackers will use a single quote to manipulate SQL code. The single quote should be escaped (which means treat it as a single quote and not a special programming character).


#

# For Exam

- TCP connect scan as a vulnerability scan: `e nmap -sT <ip address>`
- Using an unauthenticated (non-credentialed) account allows the pentester to discover information the hacker would see; however, it’s important to also remember that using an unauthenticated account will not collect as much detail as using a logon account (a credentialed account) with administrative privileges.
- Dynamic analysis tools monitor the behavior of the software while the software is running, while static analysis tools analyze the code of the application without running the software.
- Once you have the impact calculated, you also need to calculate what is known as the f(Impact) value, as this value is used in the base score calculation. The f(Impact) will be 0 if Impact is 0, otherwise f(Impact) will equal 1.176.
- Understand the format of the base score and identify the metrics: CVSS2#AV:N/AC:L/Au:N/C:C/I:C/A:C.
- To determine the higher risk vulnerability. These are tricky questions, but remember to ask yourself which one violates confidentiality, integrity, or availability (CIA). The one that does should be the higher risk vulnerability.
