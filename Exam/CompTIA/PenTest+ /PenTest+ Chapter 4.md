# CompTIA® PenTest+® Certification For Dummies®, 2nd Edition

# Chapter 4: Vulnerability Identification

Vulnerability = Weakness in a system that can be discovered and exploit to compromise the security system.

# Understanding Vulnerabilities 

Types of Vuln Scans

- Discovery Scan: Used to discover systems on network by performing ping scan and port scan to see which port is open.
  - Not a full vuln scan that look for vulnerabilities, Used to find system on network.
- Full Scan: Aggressive scan, performs many different test to identify vuln in system. Use large number of plug ins to perform different types of vuln check to check for SMTP, SNMP vuln.
- Stealth Scan: If you are hired by Org to do PenTest without the Org's Security team knowing, Hiding your presence, avoiding detection by the security team.
  - Techniques: Not scanning full IP range, scanning ports, Use multi source IP address to perform scan.
- Compliance Scan: Org that is governed by regulations for industry/business practices, perform vuln scan regular basis for regulations.
  - Need both internal and external scan.
  - External scan must be approved by approved scanning Vendor (ASV)
  - Vuln scan should run quarterly and after major change to environment.
  - If critical Vuln are found, must remediate and then new scan perform to validate the remediation have removed the vuln.

## Credentialed Vs. Non-Credentialed Scans

Should perform multi scans: At least once as non-cred user and once cred user (admin). Get different views on the system when doing both scans.

- Non-cred Vuln scan = Hacker POV should give you some vuln: ports open, maybe patches missing, will not see info such as password policies
- Cred Vuln Scan = Admin POV should give all information about the system's vuln: Vuln related to user account, group memebership, missing patches, password policy config setting.

## Application Scans

Used to perform an audit on application 

- Dynamic Analysis: Used to assess vuln in application by analyzing behavior of application while its running.
  - Not reviewing source code, reviewing the result of how application responds to input.
  - Perform in Blackbox PenTest
- Static Analysis: Given source code of Application, review the source code for vuln in application.
  - Perform in a Whitebox PenTest.

## Vuln Scan Consideration

- Timing of the Scan: Plan the best time to perfrom scan. Can stress outthe network and system being tested.
  - Perform during times when users will not epxerience negative effects of the test.
  - Be sure the systems and device that need to be tested are availabile.

- Protocol Used: Important to understand which protocols and applications are being used by Org so you can use the appropriate Plugins to detect vulnerabilities with protocols.

- Network Topology: Should have a network topology diagram to help understanding the target systems when vuln scanning.
  - Vuln scanner will have host discovery feature that can help you locate devices on the network and build network topology.
  - Understanding network topology of customer network will ensure you not to scan network outside the scope.
 
- Bandwidth Limitations: Vuln scan generates tons of network traffic, check to see if there are specific time of the day that have more bandwidth available to perform,

- Query Throtting: A technique to ensure your vuln scan does not have negative effect of overloading the systems and network -> Throttle the queries.
  - Throttle the queries: you are able to decrease or increase the frequency of the calls coming from the vuln scan
  - Ensureing system does not overburden with number of queries.
  - Increase amount of time it takes to perform Vuln scan.
 
- Fragile systems/ non-traditional assets: IoT, Vuln scan can have negative effect such as causing it to become unresponsive/ crash during vuln scan.
  - Common practice to create a test system out of image of the production system and run some trials on test system to see how it responds.

#

# Performing a Vulnerability SCan

## Running Nessus

Nessus: 
- Scan page: allow you to see your past vuln scans and run new scans.
- Settings page: allows you to modify the configuration of Nessus; # of hosts and ports that are scanned at the same time. Modify setting to improve performance of the scan/throttle the scan.

Type of Scan:
- Host Disovery: Discover live systems on network and open ports on those systems.
- Basic Network Scan: Allow to perform vuln scan on systems using default setting and pre defined plug-ins that determine types of checks scan will do.
- Advanced Scan: Similar to basic network scan, but allows you to customerize plugins scan uses (determines the vuln to check for).
- Malware Scan: Remote Windows and Linux Systems to see if there is malware present on systems.
- Web Application Test: Used to assses common vuln on websites.
- Internal PCI network Scan: Compliance scan, Org must perform vuln scans to satisfy compliance to regulations; PCI DSS regulations.

## Using Other Vuln Scanners

Nikto: Web Application vuln scanner come with Kali Linux; Command line tool used to assess the securtiy of different websites.
- List of Parameters for Nikto: `nikto --help` command.
- Nikto perform web culn scan on system with IP "192.168.67.134" on port "80", Store result in an output file: `nikto_scan` format: plain text file
  - `nikto -h 192.168.67.134 -p 80 -o nikto_scan -F txt`
 
SQLmap: Open-Source PenTesting tool used to perform SQLi attacks.
- It's important to check for common SQLi attacks on Web App that connects to a database.
- `sqlmap -u http://urlofpage/page.php?id=2 --dbs`
  - Identify page in your web app that displays data and note the URL, --dbs parameter = display information about the underlining database; type of database system it is/ database name if SQLi is successful.
- `sqlmap -u http://urlofpage/page.php?id=2 -D databasename --tables`
  - Retrieve list of tables from the database, gives a list of table names that exist in database if SQLi attack is successful.
- `sqlmap -u http://urlofpage/page.php?id=2 -D databasename -T tablename --columns`
  - Display info about those tables such as columns that exist in a table.
- `sqlmap -u http://urlofpage/page.php?id=2 -D databasename -T tablename --dump`
  - Retrieve data from a single column, retrieve data that is store in the entire table.
 
#

# Analyzing Vulnerability Results

Severity of vuln is based on CVSS (Common Vulnerability Scoring System): Range from 0 to 10
- Low: No serious security issue; 0.0 - 3.9
- Medium: Could present a security issue; 4.0 - 6.9
- High: Presents a serious security issue; 7.0 to 9.9
- Critical: Presents a very serious security issue, should deal with it immediately; 10

## Understanding the CVSS base score

CVSS = Common Vulnerability Scoring System: Divided into three parts: 
- Version
- Metric to calculate Exploitablility
- Metric used to calculate Impact of Vulnerability

![image](https://github.com/user-attachments/assets/4cfe5ebd-e0ee-4304-8f27-4874fec33727)

Exploitability Metrics: Three Metrics: AV = Attack Vector; AC = Attack Complexity; Au = Authentication


Attack Vector: Measure how hackers executes the exploits; LAN
  - Local (L): Attacker must have physical access to the vuln system or local account.
  - Adjacent Network (A): Attacker must be connected to LAN in oder to exploit the vuln
  - Network (N): Attacker can exploit vuln from remote network; does not need to be on the same physical LAN.

![image](https://github.com/user-attachments/assets/3584d5e3-36dd-4d8a-aba9-3581fe617b15)

Attack Complexity: How easy or difficult it is to exploit the vulnerability; HML
  - High (H): Special conditions needed to be met in order to hack the vuln.
  - Medium (M): Some Conditions needed to be met in order to hack the vuln.
  - Low (L): Exploiting this vuln is not difficult; no special requirements.

![image](https://github.com/user-attachments/assets/14f24728-2065-4109-913b-488bf20f1970)

Authentication: Used to specify how many times the attacker would need to authenticate to the system to exploit the vuln.
  - Multiple (M): Attacker required to authenticate two or more times when performing the exploit.
  - Single (S): Attacker required to authenticate only once while exploiting the vulnerable system.
  - None (N): Attacker is not required to authenticate to the system at all to exploit the vulnerable system.

![image](https://github.com/user-attachments/assets/6a0e34a0-5c84-4957-b3e4-0114427015b8)


Impact Metrics: Used to identify what impact is of the exploit being performed on the: NPC Format
- Confidentiality (C)
- Integrity (I)
- Availability (A)

NPC = None, Partial, Complete

![image](https://github.com/user-attachments/assets/1377aaa6-6740-4707-8484-18ab3b442916)


#

# For Exam

- TCP connect scan as a vulnerability scan: `e nmap -sT <ip address>`
- Using an unauthenticated (non-credentialed) account allows the pentester to discover information the hacker would see; however, it’s important to also remember that using an unauthenticated account will not collect as much detail as using a logon account (a credentialed account) with administrative privileges.
- Dynamic analysis tools monitor the behavior of the software while the software is running, while static analysis tools analyze the code of the application without running the software.
- Once you have the impact calculated, you also need to calculate what is known as the f(Impact) value, as this value is used in the base score calculation. The f(Impact) will be 0 if Impact is 0, otherwise f(Impact) will equal 1.176.
