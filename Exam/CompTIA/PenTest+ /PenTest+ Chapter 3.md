# CompTIA® PenTest+® Certification For Dummies®, 2nd Edition

# Chapter 3: Information Gathering

Type of information collect on Org during Information Gathering Phase:

- Email Addresses and phone numbers of employees (For Social Engineering)
- Public IP addresses used by Org.
- Target systems that are up and running.
- Open ports on target systems.
- Software used on the target systems.
- Software is running in cloud or self hosted (local server on network)

#

## Looking at Information-Gathering Tools and Techniques

Divide task into 2 parts: Passive and Active Information Gathering.

- Passive: collecting public information from internet about the Org without incoking any kind of communication with the target systems. Do first. (OSINT)
- Active: polling target system to find out about the system that are up and running, open ports and software being used. (Scanning)


Crawling Websites: Phrase to describe process of using an automated tool to fetch each page in website, analyzes the page, follows any link the page refers to and then fetch those pages.

Scraping Websites: Phrase to describe process of using program or bot to extract a copy of content in website.

Manual inspection of Web links: right clicking the link and choosing inspect from the context menu, Window opens display source code used to create the link and CSS code used.

Robots.txt: A file can be placed in the root folder of the site and contains rules on how the site and its pages are to be crawled. 
- You could create a rule in the robots.txt file that disallow specific crawling application from crawling the site.

#

## Google Hacking

Google hacking: Information gathering technique which specific keywords are used to search Google or other search engines (Bing) for information on the Internet.

- `site: <website> <keyword>`: The site keyword is used to search a specific website for a keyword.
  - If you are performing security test for Wiley publishing company: you could use site: www.wiley.com password to locate the login pages on the Wiley website.
  - This could be useful if you wanted to test Wiley’s login pages against SQL injection attacks.
 
- `intitle: <keyword>`: You can use intitle keyword to search the title of a page for specific keywords.
  - If you want to find web pages that contain the word “intranet” in the title, you could use intitle: intranet.
 
- `inurl: <keyword>`: The inurl operator will search the keyword given in the URLs found in the Google database.
  - If you want to locate sites that have the word “intranet” in the URL, you could use inurl: intranet.
 
- `intext: <keyword>`: The intext operator searches a web page for specific text.
  - If you want to search my company site for pages that contain the word “video,” you could use site: dcatt.ca intext: video.
 
- `filetype: <extension>`: One of my personal favorites is the filetype operator, which you can use to find results containing a specific file type.
  - You could search the Internet for sample penetration reports by filetype: pdf penetration test report.

#

## Referencing online Cybersecurity Sources

![image](https://github.com/user-attachments/assets/ebde4933-1e24-4758-8c1f-4fedbe7d9f02)

#

## Types of Data

Password dumps: You can use tools to obtain password dumps that display usernames and password hashes for each username. 
- The username list can be fed into a dictionary attack tool or you could use a password cracker to crack the password hashes.

File metadata: You can look at the file metadata on documents downloaded from the company’s website or other sources. 
- Metadata is additional information about the file such as the program or device used to create the file, the creator of the file, and location information.

Strategic search engine analysis/enumeration: You can use specific keywords in Google to target your search and find specific data about your target.

Website archive/caching: You can view older versions of the company’s website to get additional contact information or other information that could help in an attack. 
- For example, you could use www.archive.org and search for a website to view past versions of it.

Public source-code repositories: An archive of application source code that is made available to the public. 
- The repository may contain additional information with the source code such as technical documentation and code snippets that can be used to learn more about the company’s environment.

#

## Passive Information Gathering Tools

WHOIS: Database search tool used to discover Domain Name Information and IP Addresses about Org.
- www.godaddy.com/whois
- www.networksolutions.com/whois
- www.arin.net/whois.
  - Collect: Org's name, DNS server hosting the DNS data, contact info (email, phone number of company employees)

theHarvester: Program in Kali Linux, use to perform passive information gathering to collect info such as employee names, email address and subdomains, discover hosts owned by the Org. 
- Use it to collect public information from Google, LinkedIn, Twitter, Bing.
- Command: `theharvester -d wiley.com -b linkedin`: Searches LinkedIn users for Wiley.
- Command: `theharvester -d wiley.com -b all -l 100`: Collect info from all source "Google, LinkedIn, Twitter, limiting the result to 100.

SHODAN: search engine collects info about system connect to the internet (IoT devices).
- List of target company's publicly available servers and devices along with IP addresses, service running, open ports
- Viewing detail of the system; get list of vulnerabilities for that system.
- Map view shows phyical location of those servers.

MALTEGO: OSINT software shows a graphical representation of relationship between people, groups, web pages, and domains by analyzing online resources on (Facebook, Twitter, DNS and Whois info)
- Can create a graphic and add website address to the graphic then use Maltego to search for additional information such as Whois Information, phone number, location, email address associated with that website and have them added to the graph.

RECON-NG: OSINT tool built into Kali Linux, allows you to retrieve information such as contact names, email, DNS info, IP addresses.
- Not as easy as theHarvester; uses module concept similar to Metasploit Framework (PenTesting platform based on Ruby).

![image](https://github.com/user-attachments/assets/8f10aa24-c9c6-4424-86f2-89691775a234)

![image](https://github.com/user-attachments/assets/d0c857a0-581f-474d-97f9-8129a6cccd54)

CENSYS: Browser-based search engine that identifies hosts on Internet for Org.
- Identify the service, open ports on those system
- www.censys.io

![image](https://github.com/user-attachments/assets/36856aab-f116-4c3e-8ee9-debfb33a7f41)

FOCA: Fingerprinting Organizations with Collected Archives 
- Tool used to scan documents to collect metadata hidden from user.
- M.S Office file, Open Office files, PDF files can be scanned by FOCA to extract metadata.

DNS LOOKUPS/PROFILING: sending queries to DNS server to retrieve info on systems that might exist within the company (Mail server/Web server)
- This is the next step of whois lookup, to see what DNS record exist.
- nslookup: TCP/IP command in Windows and Linux that allows you to query DNS for different type of DNS records.
- dig: Linux command allows you to query DNS servers and obtain different records.

![image](https://github.com/user-attachments/assets/60bea1e0-8149-4fb8-8507-63701b3449df)
![image](https://github.com/user-attachments/assets/9ec094f7-7907-4351-9ba0-65cc1f5f9205)
![image](https://github.com/user-attachments/assets/96cb01a1-97f4-4c0a-b791-3b93c479e3f0)

Dig: Domain Information Gopher; Linux command
- dig www.wiley.com

![image](https://github.com/user-attachments/assets/dbe1ff3b-d32a-488e-b85b-bcd26ff4ee95)

- Can ask for a short version by adding `+short`
![image](https://github.com/user-attachments/assets/3123932c-e99f-4654-8b5f-9f746e6f2ef7)

![image](https://github.com/user-attachments/assets/e2b84a34-0db8-475b-ac39-600fce6a2e50)

- `dig wiley.com axfr` = zone transfer with dig; this probably will say "Transfer Failed" since company block full zone transfers from exposing too much info.

#

## Active Information Gathering/active Reconnaissance

Wardriving: Using a wireless scanner to discover wireless networks that exist within the company.

Network traffic: Capturing (also known as sniffing) and analyzing network traffic using a packet analyzer to discover sensitive information traveling on the network. You can also capture API requests and responses to see what type of calls a piece of software is making and the information submitted with the request or received in a response.

Cloud asset discovery: Collecting information to identify assets the company has across all cloud providers.

Third-party hosted services: Identifying any services the company is hosting with third-party companies.

Detection avoidance: Avoiding detection with the target’s intrusion detection systems while performing active reconnaissance. You will learn about some ways to do this with Nmap later in this chapter.

#

## Understanding Scanning and Enumeration

Two type of scanning: passive and active scanning.
- Passive scanning: do not interact with target hosts, but are capturing traffic on target network to see what you can pick up.
- Active scanning: Actually sending packets to the target systems to find out (OS that is running, services running on the OS).
- Perform passive scanning first because it's less likely to be detected.

#

## Passive Scanning

Involves monitoring network traffic for discovery

Packet Inspection: 
- look out for source and destination IP addresses to understand hosts existed on the network.
- look for layer 2 MAC addresses in the packets, there might be a spoof one.
- look for sensitive information in the paylod of the packets (usernames, passwords, confidential info).

Eavesdropping: Sniffing/ packet sniffing.
- Capturing network packets so you can analyze the traffic info that can help you exploit the network and systems.
- Tools: Wireshark, Linux: netdiscover (monitors network traffic for ARP message then use that info to help you discover IP addresses of hosts on newtwork and their MAC addresses).

#

## Active Scanning

Nmap, open source network scanner used to discover hosts on computer network.

### Ping Sweep (-sP or -sn): 

`nmap -sP 192.168.1.0/24` or `nmap-sn 192.168.1.0/24`

- Identify what IP addresses have live systems up and running.
- Ping Sweep: A program sends ping messages to every IP address in the network range given so that you can find out which system on the network are online.
- (-s): scan; (P): ping sweep.

### Full Connect Scan (-sT)

`nmap -sT 192.168.1.3

- TCP connect scan: Full TCP three way handshake with each port to determine if the port is open.
- Very accurate
- Downfall: traffic it generates to do three way handshake per port is easily detectable.
- (-s): doing scan; (T): specify TCP connect scan.

### Port Selection (-p)

`nmap -sT 192.168.1.0/24 -p 3389, 80, 25` RPD, HTTP, SMTP port scan

- Allows you to list ports you want to scan.

### SYN scan (-sS)

`nmap -sS 192.168.1.3`

- Generate less traffic when enumerating ports.
- SYN scan/ half open scan: send SYN message to port, port replies with SYN/ACK but system does not send ACK.
- No full conection is established; avoid more detection or less IDS trigger.

### Service Identification (-sV)

`nmap -sV 192.168.1.3`

- Find out version of software running causing port to be opened.

### OS fingerprinting (-O)

`nmap -sS -O 192.168.1.3`

- Get the Operating System running on each system.

![image](https://github.com/user-attachments/assets/1898fac4-c84e-4dee-9b7a-4e5cb39e2bf5)


### UDP scan (-sU)

`nmap -sU 192.168.1.3`

- For scanning UDP port on system or group of systems.

### Disabling Ping (-Pn)

Nmap does ping sweep first to determine if IP address is up and running. And if it isn't running, nmap skip it.

`nmap -sS -Pn 192.168.1.0/24`

- Disable ping operation contained in port scan.
- This will increase scan time, it does port scan on every IP no matter if it's running or not.

### Target input file (-iL)

`nmap -sS -iL computer.txt`

- Create a text file containing list of hosts you scan with each IP address or FQDN on its own line in file.
- Nmap will read file and use each entry in the file as one of the targets to scan.
- Useful when there are large number of hosts to scan.

### Timing (-T)

`nmap -sS -T0 192.168.1.3`

- Useful if there is intrusion detection system that will detect Nmap scan.
- This can modify the timing of each scan: slow it down.

![image](https://github.com/user-attachments/assets/450f81a1-1d53-4892-bf89-c71bc8881f69)

### Miscellaneous Options (-A)

`nmap -A 192.168.1.3`

This will do:
- OS detection
- Version detection
- Script scanning
- Traceroute

### Output parameter

Write out to a file using: `-o`

`nmap -sS 192.168.1.3 -oX wileyportscan.xml`

- -oN <filename>: output to normal information you see with Nmap to a file.
- -oX <filename>: output the info to XML file.
- -oG <filename>: Ouput info to greppable file that can be search with Linux command `grep` or `awk`.
- -oA <base_filename>: output info in all formats. Give name then output; .nmap extension, .xml extension, gnmap extension


### Packet Crafting

Challenge of scanning can be firewalls blocking packets used by the scan.
- Using pinger tool to ping system to see if system is up may not work if it's using ICMP; firewall blocks ICMP.

hping3 in Linux can craft you own packet that use TCP for ping instead of ICMP to bypass firewall.

`hping3 -c 3 -p 53 -S www.wiley.com`
- Command send 3 packets out (-c) to desetination port 53 (-p), set SYN flag in the packet so it looks the first phase of 3 way handshake (-S).
- System is being pinged with TCP.

Can also use `Scapy` to craft own packet.

#

### Other scanning Considerations:

- **Fingerprinting**: The concept of identifying the operating system running on a system. You can use the `-O` switch with Nmap to do this.

- **Cryptography**: Information-gathering tools like Shodan can download the certificate from a host for inspection. This process can reveal details such as the name of the server that issued the certificate and the certificate path.

- **Decompilation**: You can gain insight into an organization by obtaining its compiled applications (e.g., `.exe` files) and using a decompiler to convert the binary file into a readable format. This can reveal information such as remote systems the application connects to, database connection strings, or usernames and passwords used by the software.

- **Debugging**: 
  1. After decompiling an application, you can use a debugger to step through the code and analyze its behavior. This allows monitoring of variable assignments and data types.
  2. Many pentest tools have a debugging option that displays detailed information about current operations on the screen, allowing the collection of more detailed information.

#

## Enumeration

- **Hosts**: Enumerating hosts on the network helps discover existing hosts. Tools like Nmap can be used for this purpose. Zenmap, available on Kali Linux, can perform an intense scan to identify hosts and services, creating a network topology.

- **Networks**: Identify existing networks using information-gathering tools like Whois for public IP ranges. Zenmap can also create a network topology to help identify the network layout.

- **Domains**: Identify organizational domains through Whois lookups and DNS profiling. Tools like Whois, Shodan, and recon-ng are useful for collecting domain information.

- **Users**: Enumerate users with tools such as Nmap using the command: `nmap --script smb-enum-users.nse 192.168.1.3`

- **Groups**: Enumerate groups on a system using the Nmap script "smb-enum-groups.nse": `nmap --script smb-enum-groups.nse 192.168.1.3`

- **Network shares**: List SMB shares on a system using tools like SMBMap or the Nmap "script smb-enum-shares.nse": `nmap --script smb-enum-shares.nse 192.168.1.3`

- **URLs/Web pages**: After identifying systems running web servers, use tools like w3af or BurpSuite to enumerate URLs and retrieve web pages. The Nmap script "http-enum.nse" can also be used: `nmap --script http-enum.nse 192.168.1.3`

- **Applications**: Identifying software running on a system can involve running scripts to see a list of processes, often requiring credentials. Ncrack can perform dictionary attacks to obtain these credentials.

- **Services**: List services running on a system by performing an Nmap scan or using the "smb-enum-services.nse" script: `nmap --script smb-enum-services.nse 192.168.1.3`

- **Tokens**: Obtain security tokens of a user as part of exploitation tasks.

- **Social networking sites**: Use tools like recon-ng to enumerate social media posts by users with a given IP address.

- Ability to call upon vulnerability script with Nmap and scan for vulnerabilities on system: `nmap --script vuln 10.0.0.1`

#

## Analyze the results of a reconnaissance exercise

**Fingerprinting**: Know how to use software and perform operating system (OS) fingerprinting on systems, networks, and network devices. Tools like Nmap and telnet can be utilized for this purpose.

**Analyze Output**: Understand how to interpret various outputs, including DNS lookups, website crawling, network traffic, Address Resolution Protocol (ARP) traffic, and different Nmap scans. Additionally, be able to analyze web logs. 

- For example, a web server log entry might look like this:
![image](https://github.com/user-attachments/assets/a598d0ca-847c-40dc-9725-dce0d0691c19)

- Header line identifying the different fields:
  - server IP address (s-ip)
  - the HTTP method used (get or post)
  - the web page requested (cs-uri-stem)
  - the server port (s-port)
  - client IP address (c-ip)
  - program used (cs user-agent)

In this sample, the client with IP address `10.0.0.10` is requesting the page `logon.aspx` from the server at `10.0.0.1`.

#

## Defense Detection

**Load Balancer Detection**: Use the `lbd` (load balancing detector) command in Kali Linux to check if a target uses load balancing. 
- For example, `lbd wiley.com` can identify whether the Wiley domain uses DNS or HTTP load balancing.
- DNS load balancing shows IP addresses of web servers, while HTTP load balancing reveals the platform name (e.g., GWS for Google Web Server or Kestrel).

**Web Application Firewall (WAF) Detection**: To check if a target is behind a WAF, use the `wafw00f` command in Kali Linux. 
- For example, `wafw00f www.wiley.com -a -v` can reveal that Wiley is protected by a Cloudflare WAF.

**Antivirus**: During penetration testing, you may need to encode attack tools to avoid detection by antivirus software.

**Firewall Detection**: Use the `firewalk` command in Kali Linux to identify which ports a firewall forwards to a target.
- For example, `firewalk -S1-1024 -i eth0 -n -pTCP 10.0.1.1 10.0.2.50` sends TCP packets to ports 1 to 1024 through the firewall at `10.0.1.1` to reach the target at `10.0.2.50`.

#

## Security Tokens


- **Scoping**: In an application environment, security tokens can be scoped to authorize users to perform specific actions within the application.

- **Issuing**: Token issuing involves the process by which an application or environment creates new tokens. It is crucial to verify that this process is secure.

- **Revocation**: Token revocation is the process of invalidating a token to ensure that a user no longer has access to the system.



#

## For Exam

- Tool: `wget` in linux to copy the contents of a website to local folder on your system so you can review contents offline.
- Even HTTPS is used; should inspect Secure Sockets Layer (SSL) certificates for flaws such as expiration dates and certificates that have been revoked/no longer valid.
- Whois, theHarvester, Maltego, Recon-ng, Censys are tools used for OSINT gathering.
- dig and nslookup: tools used to perform DNS profiling to help identify hosts that exist within an Org.
- nmap `-sn`: Nmap ping sweep without doing port scan.
- nmap `-p`: specify target ports of the scan.
- nmap `-sS`: SYN scan
- nmap `-sT`: TCP connect scan.
- nmap `-Pn`: tell nmap to not perform ping operations at the beginning of the scan.
- nmap -sS `-T0` or `-T5`: can change the timing of the scan; decrease = 0 or increase = 5; 3 = normal.
- `Scapy` and `hping3` can craft your own packets.


