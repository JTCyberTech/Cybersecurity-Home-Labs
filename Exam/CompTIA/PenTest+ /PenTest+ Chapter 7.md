# CompTIA® PenTest+® Certification For Dummies®, 2nd Edition

# Chapter 7: Exploiting ApplicationBased Vulnerabilities

Common Application Based Attacks used to exploit company's applications and systems/data that reside behind those applications.

Also look at common Vuln found within applications, how to identify unsecure coding practices to avoid them.

#

## Looking at Common Application-Based Attacks

### Injection Attacks

- Common types of attacks against applications. Web app are vuln because their audience extended out to internet.
- Injection attack involves hacker accessing application that typically prompts for info; login information or search criteria for product.
- When application prompt for login info, hacker inserts or injects code into the application where the app expects user input.
- Problem: Developers of app may only expect regular "words" to be inserted. Input needs to be validated: testing whether it is safe input that is expected.
- Types: SQL, HTML, command, code injection attacks.

### SQL Injection Attack

- SQL = Structured Query Language; standard database language used to search or retrieve, insert, delete, modify data from database.
- To understand SQLi should understand code developer programmed into Logon button:
  - ` Select * from users where logonname = '$username' and password = '$password'` `
 
![image](https://github.com/user-attachments/assets/0a6a5fbc-c87e-4914-b682-14b34e7e16a0)

Goal
- Goal: To answer, “Is there a user that matches this username and password in our system?”
- SQLi attack just need to create a true condition.
  - Write password to test in password box, but close off the single quote (') to close the single quote that appears in the code of the button.
  - Add condition that is true `1=1`.
  - Add two dashes (--) to comment out any SQL code that the developer would execute when the Logon button is pressed. 
    - Microsoft SQL Servers uses (--); MySQL uses (#) for comment symbol.

' or 1=1 
- ` mypass' or 1=1 -- `: generate true condition.
  - Changing the query from: “Let them in if the username and password is correct", into: “Let them in if the username and password is correct or if 1=1.”
- Validating the input is important: should not accept ' or -- or # in password box; should check data for symbols and not send query to database if they exist.

Semicolon
- Semicolon (;) is needed because it allows you to run multiple commands on single line. Critical for hacker as you typing all of this into the password box.
- Developer should ensure semicolon is not the inpu before data is sent to database server.

### Type of SQLi Attacks

Blind SQL: 
- Attacker submits SQL queries into application that return info about the structure of the database in order to learn more about the target database.

Boolean SQL: 
- SQL query is submitted into application and result that is returned is either true or false.

Stacked Queries: 
  - Attacker uses a UNION statement to join multiple queries together in one command.
  - Result: a single listing made up of results from multiple tables.

![image](https://github.com/user-attachments/assets/a8807e91-a24c-4b8b-bc8f-91cc0bddff1a)

### Protecting Against SQLi Attacks

Sanitization
- SQLi attacks are successful from application allowing data input from user to contain characters that are used to control SQL statements
  - Semicolon `;`, Double dashes `--`
- Sanitization occurs when characters are removed by programmer when the data is submitted into application before input is sent to backend database for processing.

Validation
- Critical for developers to validate the input to ensure it is within scope of expected values.
- Example: if input is supposed to contain number representing quantity of items being purchased; system should check (validate) only number is allow on the input.

Parameterized Queries
- Critical countermeasure to protect against SQLi attack is to use parameterized queries.
- Parameterized query = SQL query that is set up to expect parameter (values) of particular data type that are defined at the beginning of query.
- When query is called, input is passed into parameters where input is `verified` before passing input into SQL startement of query.

#

### HTML Injection Attack

HTML Injection Attack
- Similar concept to SQLi attack
- But HTML code is inserted into application instead of SQL code.
- Typically as part of Cross Site Scripting (XSS) attack.

Goal of HTML injection Attack
- Insert HTML code into form that would get stored in database for app connected.
- If application dev did not validate or sanitize input, its possible for HTML code to be added to Database.
  - Meaning: when someone views the page later, data is read from database, browser will read and execute the new HTML that change the appearance of the page.
  - Hacker could insert HTML code to create a login form for stealing visitor's user and password.

 
### Command Injection Attack

Command Injection Attack
- Hacker insert calls to commands as input in hopes that they can execute commands within the underlining OS.

Example:
- Perl Web Application read contents of file: `http://target_site/cgi-bin/showData.pl?doc=user1.txt`
- If it's vulnerable to command injection, hackers could alter reference to document to reference an executable:
  - `http://target_site/cgi-bin/showData.pl?doc=/bin/ls|`
- PHP environment, can attempt to make call to OS command by appending a semicolon to the end of the URL then referencing OS cammand.
  - `%3B` = `;`, `%20` = space: for URL encoding.
  - Making a call to `cat` command trying to display passwd file: `http://target_site/showData.php?dir=%3Bcat%20/etc/passwd`
 
Key:
- Command injection is that URL contains reference to OS command.
- Not SQL code: select, insert, update or delete command.


### Code Injection Attack

Code Injection Attack
- Hacker inserts application code into application of the language was written in.

Example:
- Web Application: hackers could insert JavaScript into web app causing the app to execute in a way not expected.
- PHP Application: hackers would try to inject PHP code that is used to discover information about the environment.
  - PHP site that is vuln to code injection would show info about PHP setup: `http://target_site/showData.php?id=1;phpinfo()`
  - Call to a function with `()` brackets at the end = good indication of code injection.
  - Calling to OS command will not have brackets.
 

### LDAP Injection and XML Injection Attacks

LDAP Injection Attack
- Lightweight Directory Access Protocol (LDAP) = a common protocol used to access directory services containing listings of users and other object within a company.
- Attacker inserts LDAP commands into an application that makes an LDAP call to directory service.
- Commands could be used to retrieve info from directory or make unauthorized modification.

XML Injection
- XML data is inserted into application to obtain undesired result.
- Example: if applciation is not validating input, hacker could inject XML data so data is altered or even new data is created in the application.

#

## Authentication Attacks

Methods used to try to bypass authentication or compromise security of application by cracking the application's passwords.

### Credential Brute-forcing

Credential Bruteforcing
- Technique used to compromise app security
- Crack the passwords for user accounts of the app.
- Tools: John the Ripper, Hashcat.


### Session Attacks and Session Hijacking

Session Attack
- HTTP uses session token (cookie) that is created when client connects to website.
- Token is used by web server to know who is sending the request.
- Attacker can take over the session and impersonate you by performing a session attack.
  - Obtain the session token and start sending requests to the server with that token.
 
Session Hijacking
- A way hackers can gain access to web app without needing to crack passwords.
- When user logs onto website, session token is sent to that user's browser as a flag that user has been logged in.
- Hackers can obtain that token or cookie info, use that info to access application without needing to authenticate because app thinks already authenticated.
- Hacker can obtain the cookie or token info from client by exploiting client's system or eavesdropping communication if not encrypted.


### Redirect

Redirect
- Occurs when request is sent to a server, a page that needs to be filled in by user.
- URL also contains a redirect parameter that is used to automatically send user to another page following the submission of the form.

Example: `http://site/purchase.aspx?redirect=confirmation.aspx`
- If dev of app does not validate target of the redirect, it is possible that the hacker can change this redirect
- Have the user redirected to a site that prompts user to login.
- redirect: `http://site/purchase.aspx?redirect=www.hackersite.com`


### Default Credentials

Default Credential Attack
- Occurs when hacker uses device's or system's default credentials to gain access.
- Hoping admin has not change them.
- Common with devices like routers and switches that have default credentials config by manufacturer.
- As an admin, first thing should change the default credentials.


### Weak Credentials

Weak Credentials 
- Hacker can assess passwords of system with tools; Hydra, John the Ripper.
- Tools can also perform dictionary attack with wordlist file
- Cracking tools tries each word in the file.
- Be sure to config complex password for all accounts including upper and lowercase, number and symbols, at less 8 character long.


### Kerberos Exploits

Kerberos
- Authentication protocol built into Windows networks that uses a `Ticket Granting Services` (TGS).
- When client logs on network, client receives `Ticket Granting Ticket` (TGT) from Kerberos Key Distribution Center (KDC).
- TGT = Authentication ticket, only given after KDC verifies the credentials of user logging in.
  - Client must get a session key from TGS if they wants to access a service on network. 
  - To get session key from TGS, client sents TGT it received after logon to TGS as verification.
  - TGT is verified and client has permission to access the service, session key is sent to client.
 
Exploits
- Brute-Forcing: To identify user accounts, crack passwords, and gain access to TGT for users by using tools such as Python Script `Kerbrute.py` or `Rebeus` for Windows.
  - Both tools uses user list file and password list file to identify whether user account exists and password is cracked.
- Silver Tickets: A forged TGS ticket (session key) used to gain access to service.
  - If hacker present TGS ticket to service, there is no need for service to check with kerberos service, as it thinks hacker is authorized due to having TGS ticket.
 

#

## Authorization Attacks

Two common Technieuqes that can be used to bypass Authorization features and compromise system = Parameter Pollution and Insecure Direct Object Reference

### Parameter Pollution

Parameter Pollution
- Also known: HTTP Parameter Pollution
- A way to try to confuse application and bypass the input validation in web application by supplying same parameter value multiple times in the HTTP request.

Example: 
- Viewing list of products, URL normally look like:
  - `http://site/logon.aspx?uname=bob&pass=1234`
- We are logging into app with username and password, with parameter pollution, trying to supply same parameter a second time and inject malicious content:
  - `http://site/logon.aspx?uname=bob&pass=1234&pass=1234' or 1=1 --`

Goal: 
- Input validation may only occur on the first occurrence of the parameter
- Might be able to slip in SQLi attack to bypass the security.
- Even if parameter pollution does not work, it can provide application erroe that is user for discovering more about environment the app is running in.
  - The platform the app is running on or database environment being utilized to hold app data.
 

### Insecure Direct Object Reference

Insecure Direct Object Reference (IDOR)
- Vulnerability where dev of application does not implement authorization features to verify that someone accessing data on site is allowed to access that data.


Example: 
- Client that has a web app that its customers login to make purchases.
- Client stores purchase history and payment details in tables in database.
- When customer view their purchase history; URL: 
  - `http://site/purchasehistory.php?cid=109`
 
- Insecure Direct Object access is vuln that allow you to change customer ID in URL to view sensitive information of another customer (object):
  - `http://site/purchasehistory.php?cid=110`
 
Overview
- Being able to view purchase info for another customer is huge security issue within the app.
- This is a common vulnerability in many web app.

#

## For the Exam

- Be able to look at URL and understand what type of attack is being performed.
- SQLi attack; URL would have database code containing `;` and `--` : `http://site/product.php?id=5;update%20products%20set%20price=.50`
  - %20 = URL encoding for a space.
- Know different types of SQLi attacks that can be used during PenTesting.
- Be sure to know how to identify different types of Injection attacks by URL.
- Object Reference attack occurs when attacker modifies the item being referenced in URL; for example: `?id=5` changed to `?id=9`
